!function(e){var t={};function n(a){if(t[a])return t[a].exports;var r=t[a]={i:a,l:!1,exports:{}};return e[a].call(r.exports,r,r.exports,n),r.l=!0,r.exports}n.m=e,n.c=t,n.d=function(e,t,a){n.o(e,t)||Object.defineProperty(e,t,{configurable:!1,enumerable:!0,get:a})},n.r=function(e){Object.defineProperty(e,"__esModule",{value:!0})},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=320)}({320:function(e,t,n){"use strict";!function(e){var t=e.$,n=t.each,a=t.Deferred,r=t.ajax,i=e.utils,o=i.getObjectProperty,l=i.parseAsJSONIfString,s=e.dataSource,d=s.utils,c=e.constants,u=c.DATASOURCE,p=c.DISPLAY_TYPES,f=c.MIME_TYPES,m=c.HTTP_VERBS,y=f.JSON,h=p.DATETIME,v=p.NUMBER,b=p.OBJECT,T=p.STRING,g=p.IMAGE,x=m.GET,P=m.PATCH,S=m.DELETE,R=u.SEARCH_CONDITION,A=function(e){var t,a,r=function(e,t){var a={};return n(e,function(e,n){n.inactive||(a[n.sourceParam||n.name]=encodeURI(i.mergeAsTextInContext(n.value,t)))}),a}(e.model.conditions,e),o=r[R],l=r["Parent Folder"],s=r.extension||"";l?-1===l.indexOf("/")?a="/_api/v2.0/drive/items/"+l+"/children":(t=(l=l.split(" ").join("%20")).split("/"),a="/_api/v2.0/drive/root:"+l,s||-1!==t[t.length-1].indexOf(".")||(a+=":/children")):a="/_api/v2.0/drive/root/children",o&&(a=l&&-1===l.indexOf("/")?"/_api/v2.0/drive/items/"+l+"/view.search?q="+o:"/_api/v2.0/drive/root/view.search?q="+o),e.request.url=a};s.getDataSourceType("MicrosoftOneDrive")||new s.core.RESTDataSourceTypeBase({name:"MicrosoftOneDrive",coerceRequest:function(e){var t=e.type,n=e.request.data;if(!e.request.url)if("query"===t)A(e);else if(("update"===t||"delete"===t)&&(e.request.url="/_api/v2.0/drive/items/"+e.originalRecordId,"update"===t)){var a=n.parentDirectory||"";e.request.data.parentReference={path:"/drive/root:"+a},delete e.request.data.parentDirectory}e.request.headers={Accept:y}},parseSuccessfulLoadResponse:function(e,n,a,r){var o,l,s,d,c=this.parseResponseBodyAsJSON(e.body),u=n.pathToContent,p=r.conditions,f=[];if(t.each(p,function(e,t){"extension"===t.name?o=t.value:"Parent Folder"===t.name&&(l=t.value)&&(s=l.split("/"))}),d=l&&-1!==s[s.length-1].indexOf(".")?c:u?i.getObjectProperty(c,u):c,t.isArray(d))t.each(d,function(e,t){var n;if(o){var a=t.name.split(".");n=a?a.slice(-1)[0]:""}if(o&&-1===n.indexOf(o))delete d[e];else{var r=t.parentReference.path,l=r?r.split(":")[1]:t.parentReference.id;t.createdByUserName=i.getObjectProperty(t,"createdBy.user.displayName"),t.lastModifiedByUserName=i.getObjectProperty(t,"lastModifiedBy.user.displayName"),t.parentDirectory=l,t.oneUp=l.substring(0,l.lastIndexOf("/")),t.downloadUrl=t["@content.downloadUrl"],f.push(t)}}),d=f;else{var m=d.parentReference.path,y=m?m.split(":")[1]:d.parentReference.id;d.createdByUserName=i.getObjectProperty(d,"createdBy.user.displayName"),d.lastModifiedByUserName=i.getObjectProperty(d,"lastModifiedBy.user.displayName"),d.parentDirectory=y,d.oneUp=y.substring(0,y.lastIndexOf("/")),d.downloadUrl=d["@content.downloadUrl"],d=[d]}return d},getUploadMethods:function(){return{"Direct Upload":{label:"Direct Upload",canRunPostUploadSnippet:!0,upload:function(t,a,r,o,s,d){var c,u,p,f,m=encodeURIComponent(i.renameFileWhileKeepingExtension(t.name,i.mergeAsTextInContext(r.filename,r))),h=new FileReader,v=r.model,b=v.dataSource,T=v.conditions,g=b.serviceUrl,x=t.size,P=e.platform.getMaxProxyRequestPayload(),S=1;function R(e){if(e&&e.body){var t=e.body;if(t&&t.error&&t.error.message)return t.error.message}return"Had an error"}function A(t,n){return e.utils.inPlatform(e.constants.NATIVE)?t:"atob"===n?atob(t):"btoa"===n?btoa(t):void 0}function O(){var e=A(f[0],"atob").length-1;return d({loaded:S,total:p}),b.makeRequest(b.createHTTPRequest({url:c,headers:{"Content-Range":"bytes 0-"+e+"/"+x,"Content-Length":f[0].length,Accept:y},contentType:"application/octet-stream",method:"PUT",body:f[0]})).then(function(e){1===p?s():function e(t){d({loaded:++S,total:p}),b.authenticate(r).then(function(){if(S===p)!function(e){var t=l(e.body).nextExpectedRanges[0].split("-")[0],n=parseInt(t,10)+A(f[S-1],"atob").length-1;b.makeRequest(b.createHTTPRequest({url:c,headers:{"Content-Range":"bytes "+t+"-"+n+"/"+x,"Content-Length":f[S-1].length,Accept:y},contentType:"application/octet-stream",method:"PUT",body:f[S-1]})).then(function(e){202===e.statusCode?s({message:"Upload failed!"}):s()},function(e){s({message:R(e)})})}(t);else{var n=l(t.body),a=n.nextExpectedRanges[0].split("-")[0],r=parseInt(a,10)+A(f[S-1],"atob").length-1;b.makeRequest(b.createHTTPRequest({url:c,headers:{"Content-Range":"bytes "+a+"-"+r+"/"+x,"Content-Length":f[S-1].length,Accept:y},contentType:"application/octet-stream",method:"PUT",body:f[S-1]})).then(function(t){e(t)},function(e){s({message:R(e)})})}})}(e)},function(e){s({message:R(e)})})}n(T,function(e,t){u=t.value||""}),h.readAsBinaryString(t),h.onloadend=function(){f=h.result,p=Math.ceil(x/P),b.authenticate(r).then(function(){f=function(e,t){for(var n=e.length,a=[],r=Math.ceil(n/t),i=0;i<t;i++)a[i]=A(e.slice(r*i,r*(i+1)),"btoa");return a}(f,p),function(){var e;o({fileName:r.filename||t.name}),e=u&&-1===u.indexOf("/")?g+"/_api/v2.0/drive/items/"+u+":/"+m+":/upload.createSession":u&&"/"!==u?g+"/_api/v2.0/drive/root:"+u+"/"+m+":/upload.createSession":g+"/_api/v2.0/drive/root:/"+m+":/createUploadSession";var n=b.createHTTPRequest({url:e,method:"POST",headers:{"Content-Length":0,Accept:y}});return b.makeRequest(n)}().then(function(e){var t=l(e.body);c=t.uploadUrl,O()},function(e){s({message:R(e)})})})}},needsModelInContext:!0}}},parseAdditionalQueries:function(e,n,a,r){var i=o(l(e.body),r.method.pathToContent);t.isArray(i)&&(i=i[0]),n.fields.forEach(function(e){e.defer&&t.inArray(e.id,r.method.fields)>-1&&(a[e.id]=o(i,e.path))})},createActions:function(t){return{"create-folder":{label:"Create new folder",builderProps:[{label:"Model with Parent Folder Condition",id:"model",type:"model",helptext:"Will take the value in this model's parent folder condition, and use it as the parent folder for the new folder",entryFilter:i.filterByDataSourceAndEntity(t.name,"File")},{label:"Folder Name",id:"foldername",type:"string"}],runtimeExecution:function(t,o,l,s){var d,c=e.$M(i.mergeAsDataInContext(t.attr("model"))),u=c.dataSource.serviceUrl,p="",f=i.mergeAsTextInContext(t.attr("foldername"),l),m=a();return n(c.conditions,function(e,t){"Parent Folder"===t.sourceParam&&(p=i.mergeAsTextInContext(t.value,l)||p)}),d={name:f,folder:{},"@name.conflictBehavior":"rename"},p&&-1===p.indexOf("/")?r({url:u+"/_api/v2.0/drive/items/"+p+"/children",headers:{Authorization:"Bearer "+s.authentication.responseBody.access_token,"Content-Type":"application/json"},method:"POST",dataType:"json",data:JSON.stringify(d),success:function(){m.resolve()},error:function(e){m.reject(e)}}):r({url:u+"/_api/v2.0/drive/root:"+p,headers:{Authorization:"Bearer "+s.authentication.responseBody.access_token},method:"GET",dataType:"json",success:function(e){r({url:u+"/_api/v2.0/drive/items/"+e.id+"/children",headers:{Authorization:"Bearer "+s.authentication.responseBody.access_token,"Content-Type":"application/json"},method:"POST",dataType:"json",data:JSON.stringify(d),success:function(){m.resolve()},error:function(e){m.reject(e)}})},error:function(e){m.reject(e)}}),m.promise()}},copy:{label:"Copy a File",builderProps:[{label:"Model with Parent Folder Condition",id:"model",type:"model",helptext:"Will take the value in this model's parent folder condition, and use it as the parent folder for the new folder",entryFilter:i.filterByDataSourceAndEntity(t.name,"File")},{label:"File Name",id:"filename",type:"string"}],runtimeExecution:function(t,o,l){var s,d,c=e.$M(i.mergeAsDataInContext(t.attr("model"))),u=l.row,p=u.parentReference.path,f=p?p.split(":")[1]:u.parentReference.id,m=c.dataSource,y=m.serviceUrl,h="",v=i.mergeAsTextInContext(t.attr("filename"),l),b=a();return n(c.conditions,function(e,t){"Parent Folder"===t.sourceParam&&(h=i.mergeAsTextInContext(t.value,l)||h)}),d={parentReference:u.parentReference,name:v},s=h?h&&-1===h.indexOf("/")?y+"/_api/v2.0/drive/items/"+u.id+"/action.copy":y+"/_api/v2.0/drive/root:"+f+"/"+u.name+":/action.copy":y+"/_api/v2.0/drive/root:/"+u.name+":/action.copy",r({url:s,headers:{Authorization:"Bearer "+m.authentication.responseBody.access_token,"Content-Type":"application/json",Prefer:"response-async"},method:"POST",dataType:"json",data:JSON.stringify(d),success:function(){b.resolve()},error:function(e){b.reject(e)}}),b.promise()}}}},getEntityList:d.getEntityListStatic,queryEntityMetadata:d.queryEntityMetadataStatic,getActions:d.getActionsStatic,extendedProperties:{composer:{unomittableFields:!0,hasEntityOptions:!0},hasDefaultSearch:!0,canServerSearch:!0,hasGlobalSearchEntities:!0,"x-metadata":{__skuid_fieldDefaults:{File:{displaytype:T,editable:!1,createable:!1,accessible:!0}},File:{idFields:["id"],nameField:"name",label:"File",labelPlural:"Files",fields:[{id:"id",inlineHelpText:"Identifier of the drive.","x-alwaysinclude":!0},{id:"name",inlineHelpText:"Name of the drive.",editable:!0},{id:"createdByUserName"},{id:"createdDateTime",displaytype:h},{id:"lastModifiedByUserName"},{id:"lastModifiedDateTime",displaytype:h},{id:"webUrl"},{id:"parentReference",displaytype:b,accessible:!1},{id:"size",displaytype:v},{id:"parentDirectory",editable:!0},{id:"oneUp",label:"Directory Up"},{id:"downloadUrl",label:"Download Link"},{id:"smallThumbnail",label:"Thumbnail (Small)",displaytype:g,defer:!0,path:"small.url"},{id:"mediumThumbnail",label:"Thumbnail (Medium)",displaytype:g,defer:!0,path:"medium.url"},{id:"largeThumbnail",label:"Thumbnail (Large)",displaytype:g,defer:!0,path:"large.url"}],methods:{query:{url:"",verb:x,contentType:y,pathToContent:"value",additionalRequests:[{url:"/_api/v2.0/drive/items/{{id}}/thumbnails",verb:x,contentType:y,pathToContent:"value",fields:["smallThumbnail","mediumThumbnail","largeThumbnail"]}]},update:{url:"",verb:P,contentType:y,receiveDataAs:"recordinbody",successIf:"responsefieldispresent",successField:"name"},delete:{url:"",verb:S,contentType:y},search:{url:"/_api/v2.0/drive/root/view.search?q={{search}}",verb:x,contentType:y,pathToContent:"value"}},defaultConditions:[{sourcetype:"param",sourceparam:"Parent Folder",name:"Parent Folder",label:"Path to File/Folder",state:"filterableon",value:""},{sourcetype:"param",sourceparam:"extension",name:"extension",label:"File Extension",state:"filterableon",value:""}]}}}})}(skuid)}});