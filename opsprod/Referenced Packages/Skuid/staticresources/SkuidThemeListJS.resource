!function(e){var r={};function t(i){if(r[i])return r[i].exports;var s=r[i]={i:i,l:!1,exports:{}};return e[i].call(s.exports,s,s.exports,t),s.l=!0,s.exports}t.m=e,t.c=r,t.d=function(e,r,i){t.o(e,r)||Object.defineProperty(e,r,{configurable:!1,enumerable:!0,get:i})},t.r=function(e){Object.defineProperty(e,"__esModule",{value:!0})},t.n=function(e){var r=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(r,"a",r),r},t.o=function(e,r){return Object.prototype.hasOwnProperty.call(e,r)},t.p="",t(t.s=284)}({284:function(e,r,t){"use strict";!function(e){var r=e.$,t=e.snippet.registerSnippet,i="skuid-platform"===e.platform.getName(),s=e.utils;t("skuid.loadJSZip",function(){var t=r.Deferred();if("undefined"!=typeof JSZip)t.resolve();else{if(i)return s.loadJS(e.platform.getResourceUrl({name:"lib/jSZip.js",namespace:"skuid"}),t.resolve);s.loadJS(s.getStaticResourceUrl("JSZip","skuid"),t.resolve)}return t.promise()}),t("skuid.settings.copyPrefsFromOrgDefault",function(){var t=arguments[0],i=t.row,a=t.model,o=e.$M("stng__OrgPreferences"),n=o.getFirstRow(),u={};r.each(o.fields,function(){s.startsWith(this.id,"skuid__")&&"skuid__Use_Component_Packs__c"!==this.id&&(u[this.id]=o.getFieldValue(n,this.id,!0))}),a.updateRow(i,u,{initiatorId:t.initiatorId})}),t("skuid.theme.createThemeResource",function(){var r=arguments[0],t=e.$,a=r.row,o=r.model,n="Ink"===a.skuid__Type__c||"Ink"===a.type;i&&(a.skuid__Skuid_Version_Date__c=e.version.date);var u,d,c,_=a.BaseTheme;i?(u=a.name,d="Mobile"===a.type,c=a.resource_name):(u=a.Name,d="Mobile"==a.skuid__Type__c,c=a.skuid__Resource_Name__c);var p=!1;if(t.each(o.registeredLists,function(e,r){if(r.validateRequiredFields().length)return p=!0,!1}),p)return t.Deferred().reject();var l=["skuid_theme.json","resources.json"];n||l.push("skuidtheme.css");var m="SkuidTheme"+a.BaseTheme,f=e.$.map(l,function(r){var t=e.platform.themeBuilder.getThemeResourceUrl({name:m,nestedPath:r});return e.$.ajax({url:t})});return e.$.when.all(f).then(function(r){var p=r[0][0],l=r[1][0],m=r[2]&&r[2][0],f={id:u,lessVars:{},tempVars:{},webFonts:p.webFonts,baseTheme:_,isMobile:d,themeSettings:{}},v=new JSZip;v.file("skuid_theme.json",JSON.stringify(f,void 0,"\t")),v.file("resources.json",JSON.stringify(l)),n||(v.file("skuidbuilderstheme.css",m),v.file("skuidtheme.css",m),v.file("skuidicons.css",m));var h={ContentType:"application/zip",Body:v.generate({type:"base64",compression:"DEFLATE"}),CacheControl:"Public"};return i?h.FileName=c:(h.Name=c,h.skuid__Resource_Namespace__c=a.skuid__Resource_Namespace__c),t.ajax({type:"POST",url:i?"/api/v1/uploadTheme":"/services/data/v32.0/sobjects/StaticResource",headers:{"Content-Type":"application/json",Authorization:"Bearer "+s.userInfo.sessionId},data:JSON.stringify(h),dataType:"json"}).then(function(r){if(!i)return e.sfdc.api.query("SELECT NamespacePrefix FROM StaticResource WHERE Id='"+r.id+"'").then(function(r){o.updateRow(a,{skuid__Skuid_Version_Date__c:e.version.date,skuid__Resource_Namespace__c:r.records[0].NamespacePrefix})});o.updateRow(a,{version_date:e.version.date,file_id:r.id})})})}),t("skuid.theme.exportTheme",function(){var r=arguments[0],t=e.$.Deferred(),a=r.row,o=r.model.getRecordForRow(a).get();(i?["id","file_id","updated_at"]:["Id","LastModifiedById","LastModifiedBy","attributes"]).forEach(function(e){delete o[e]});var n,u,d,c=JSON.stringify(o);return i?(n=a.resource_name,d=e.platform.themeBuilder.getThemeResourceUrl(a.resource_name)):(n=a.skuid__Resource_Name__c,u=a.skuid__Resource_Namespace__c,d=s.getStaticResourceUrl(n,u,void 0,(new Date).getTime())),JSZipUtils.getBinaryContent(d,function(e,r){if(e)return t.reject();var i=new JSZip;i.load(r),i.file("objdef.json",c);var a=i.generate({type:"blob",compression:"DEFLATE"});s.saveAs(a,n.replace(/SKTHEME/g,"")+".sktheme"),t.resolve()}),t.promise()});var a=function(){var r=e.$,t=arguments[0].record,i=t.id||t.Id,s=e.$M("stng__Themes_Import"),a=JSZip(t.Body,{base64:!0});if(s.cancel(),a.files["objdef.json"]){var o,n,u,d,c=JSON.parse(a.files["objdef.json"].asText()),_=e.$M("stng__Themes_"+c.skuid__Type__c),p="SELECT Id FROM skuid__Theme__c WHERE Name='"+c.Name+"'";i?(u="SELECT Id,NamespacePrefix,Name FROM StaticResource WHERE Id='"+i+"'",d=e.sfdc.api.query(u).then(function(e){e&&e.records&&e.records[0]&&(n=e.records[0],d.resolve())})):d=r.Deferred().resolve();var l=e.sfdc.api.query(p).then(function(e){return e.records&&e.records[0]?(o=e.records[0],e):r.Deferred().reject()});r.when(l,d).then(function(){s.conditions[0].value=o.Id,n?(c.skuid__Resource_Name__c=n.Name,c.skuid__Resource_Namespace__c=n.NamespacePrefix):(delete c.skuid__Resource_Name__c,delete c.skuid__Resource_Namespace__c),s.updateData(function(){var e=s.updateRow({Id:o.Id},c);s.save(),_.adoptRow(e)})}).catch(function(){var e=s.createRow({additionalConditions:[{field:"Name",value:c.Name},{field:"skuid__Resource_Name__c",value:n.Name},{field:"skuid__Type__c",value:c.skuid__Type__c},{field:"skuid__Active__c",value:c.skuid__Active__c},{field:"skuid__Skuid_Version_Date__c",value:c.skuid__Skuid_Version_Date__c},{field:"skuid__Resource_Namespace__c",value:n.NamespacePrefix}]});s.save({callback:function(t){if(t.messages&&t.messages.length){var i=r("#themeImportErrors").length?r("#themeImportErrors"):r('<div id="themeImportErrors" class="nx-error">');i.prependTo(r("#importUploadTitle")),i.empty(),r.each(t.messages,function(e,r){i.append("<div>"+r+"</div>")})}else _.adoptRow(e)}})})}else alert("The uploaded file is not a valid skuid theme")};t(i?"skuid.theme.importThemeDeprecated":"skuid.theme.importTheme",a),t("resourceNamer",function(){var e=!1,t=r(".popup-resource-name input");r(".popup-theme-name input").on("input",function(r){var s;e||(s=i?r.target.value?r.target.value.match(/^[\w _-]+$/).join(""):"":r.target.value.match(/[a-z]|[A-Z]|[0-9]/g).join("").replace(/SKTHEME/g,"")+"SKTHEME",t.val(s),t.trigger("input"))}),t.on("keypress",function(){e=!0})})}(skuid)}});