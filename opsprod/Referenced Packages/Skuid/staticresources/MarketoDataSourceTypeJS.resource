!function(e){var t={};function a(r){if(t[r])return t[r].exports;var i=t[r]={i:r,l:!1,exports:{}};return e[r].call(i.exports,i,i.exports,a),i.l=!0,i.exports}a.m=e,a.c=t,a.d=function(e,t,r){a.o(e,t)||Object.defineProperty(e,t,{configurable:!1,enumerable:!0,get:r})},a.r=function(e){Object.defineProperty(e,"__esModule",{value:!0})},a.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return a.d(t,"a",t),t},a.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},a.p="",a(a.s=323)}({323:function(e,t,a){"use strict";!function(e){var t=e.$,a=e.utils,r=a.parseAsJSONIfString,i=e.constants,l=i.DISPLAY_TYPES,n=l.DATETIME,d=l.BOOLEAN,o=l.ID,s=l.STRING,u="Lead",p={},c=e.dataSource,y=c.utils,m=a.grab,b=y.REST,f=i.MIME_TYPES.JSON,T=l.NUMBER,g={Person:1,Campaign:2,Program:3,Folder:4,StaticList:5,Channel:6,ActivityType:7,Activity:8,Tag:9},v="List",h="Id",P="query",I=function(e,a){var r={sourcetype:"param",state:"filterablerequired",type:"fieldvalue",required:!0,value:"",name:e};if(r.name=e,r.label=e===v?"List Id":"ProgramId"===e?"Program Id":e===h?"Marketo GUID":e,a){var i={};t.each(a.fields,function(e,t){i[t.id]=t});var l=[],n={};t.each(a.searchableFields,function(e,a){t.each(a,function(e,t){n[t]||(n[t]=!0,l.push({value:t,label:i[t].label}))})}),r.picklistEntries=l}return r.sourceparam=r.name,r},C=function(e){e=e.toUpperCase();var t={SCORE:T,FLOAT:T};return t[e]?t[e]:e},S=function(e,t,i,l){return!1!==l&&p[t]?y.deferrable(p[t]):e.authenticate().then(function(){var r={url:t=-1===t.indexOf("rest")?a.combineUrls(a.combineUrls(e.serviceUrl||"","/rest/v1/"),t):a.combineUrls(e.serviceUrl||"",t)};return i?(l=!1,r.method="POST",r.data=i,r.body=i,r.contentType=f):r.method="GET",e.makeRequest(e.createHTTPRequest(r))}).then(function(e){if(!(e=r(e))||!e.body)throw"Failed to connect to Marketo";var a,i=r(e.body);if(!i.success)throw"Bad request made to Marketo";if(i.result?a=i.result:i.nextPageToken&&(a=i.nextPageToken),!a)throw"No result in response";return!1!==l&&(p[t]=a),a})},E=function(e){return{Custom:"customobjects.json",Person:"leads/describe.json",Lead:"leads/describe.json"}[e]||"customobjects/"+e+"/describe.json"},k=function(e){var a=e.idField;return{fields:t.map(e.fields,function(e){var t={displaytype:C(e.dataType),label:e.displayName,id:e.name,editable:!1!==e.updateable,createable:!1!==e.createable};return e.name===a&&(t.editable=!1,t.createable=!1,t.omittable=!1),t}),idFields:[a],searchableFields:e.searchableFields}},A=function(e){var a=e.type,r=e.request,i=e.model,l=e.row,n=r.data,d={},o=y.getModelMergeConditions(i,e),s=r.url,u=o.List,p=o.ProgramId,c=o.Id;if(a===P)if(p)s+="leads/programs/"+p+".json";else if(u)s+="list/"+u+"/leads.json";else{if(!c)throw"Must query persons using a non-empty condition value";s+="leads.json?filterType=id&filterValues="+decodeURIComponent(c)}else"delete"===a?(s+="leads/delete.json",d={input:[{id:l.id}]}):(s+="leads.json",d={input:[t.extend({},n)]},"update"===a?(d.input[0].id=l.id,d.lookupField="id",d.action="updateOnly"):d.action="createOrUpdate");d&&(r.data=d),r.url=s},M=function(e){e.model.dbType="Asset",e.request.url="/rest/asset/v1/"},q=function(e){e.model.dbType="Lead",e.request.url="/rest/v1/"};c.getDataSourceType("Marketo")||new c.core.RESTDataSourceTypeBase({name:"Marketo",coerceRequest:function(e){var a=e.model,i=a.fields,l=e.type,n=e.request,d=this.getEntityMetadataCacheKey(a);switch(d){case u:case"Person":q(e),A(e);break;case"Campaign":q(e),function(e){var t=e.model,a=e.request,r=a.url,i=e.type,l=y.getModelMergeConditions(t,e);i===P&&(0===l.campaignId.length?a.url=r+"campaigns.json":(r+=e.method.url,a.url=r))}(e);break;case"StaticList":case"ActivityType":q(e),function(e){var t=e.request,a=t.url;e.type===P&&(a+=e.method.url),t.url=a}(e);break;case"Activity":q(e),function(e){var t=e.model,a=e.request,r=a.url,i=e.type,l=y.getModelMergeConditions(t,e),n=l.personIds,d=l.activityTypeIds,o=t.tokenVal;r=i===P&&t.paginationToken?r.concat(e.method.url):r.concat(e.method.url,"leadIds=",n,"&activityTypeIds=",d,"&nextPageToken=",o),a.url=r}(e);break;case"Program":M(e),function(e){var t=e.model,a=e.request,r=a.url,i=e.type,l=y.getModelMergeConditions(t,e);if(i===P)if(0===l.tagType.length&&0===l.tagValue.length)a.url=r+"programs.json";else{if(0===l.tagType.length||0===l.tagValue.length)throw"Model "+t.label+' had an error: both tagType and tagValue conditions must be present to query Program by Tag. Without either, query will default to "all" Programs';r+=e.method.url,a.url=r}if("insert"===i){r+=e.method.url,a.url=r;var n=a.data.value,d=a.data.channel,o=a.data.description,s=a.data.folderType,u=a.data.name,p=a.data.type,c={id:n,type:s};a.data="name="+u+"&folder="+JSON.stringify(c)+"&type="+p+"&channel="+d,o&&(a.data=a.data.concat("&description="+o)),a.contentType="application/x-www-form-urlencoded"}"update"===i&&(r+=e.method.url,a.url=r)}(e);break;case"Folder":M(e),function(e){var t=e.model,a=e.request,r=a.url,i=e.type,l=y.getModelMergeConditions(t,e);i===P&&(l.maxDepth?(r+=e.method.url,a.url=r):(r+="folders.json",a.url=r))}(e);break;case"Channel":M(e),function(e){var t=e.model,a=e.request,r=a.url,i=e.type,l=y.getModelMergeConditions(t,e);i===P&&(l.channelName?(r+=e.method.url,a.url=r):(r+="channels.json",a.url=r))}(e);break;case"Tag":M(e),function(e){var t=e.request,a=t.url;e.type===P&&(a+=e.method.url),t.url=a}(e);break;default:!function(e,a){var i=e.type,l=e.request,n=e.model,d=y.getModelMergeConditions(n,e),o=l.url,s=d.filterType,u=d.filterValues;if(o+="customobjects/"+a+".json",i===P){if(!s||!u)throw"Must have a valid filterType and filterValue condition set";u=r(u),t.isArray(u)&&(u=u.join(",")),o+="?filterType="+s+"&filterValues="+u}l.url=o}(e,d)}l===P&&(-1===n.url.indexOf("?")?n.url+="?":n.url+="&",n.url+="fields="+t.map(i,function(e){if(e.id&&!e.uiOnly)return e.id}).join(","),a.recordsLimit||(a.recordsLimit=150),"Lead"===e.model.dbType?a.recordsLimit&&(0|a.recordsLimit)+""==a.recordsLimit+""&&("Activity"===e.model.objectName?n.url+="&batchSize="+(0|a.recordsLimit):n.url+="&batchSize="+(1+(0|a.recordsLimit))):"Asset"===e.model.dbType&&a.recordsLimit&&(0|a.recordsLimit)+""==a.recordsLimit+""&&(n.url+="&maxReturn="+(1+(0|a.recordsLimit))))},createActions:function(){return{"add-lead-to-static-list":{label:"Add a Person to a Static List",builderProps:[{label:"Person ID",id:"personId",type:"string"},{label:"List ID",id:"listId",type:"string"}],runtimeExecution:function(e,t,r,i){var l=a.mergeAsTextInContext(e.attr("personId"),r),n=a.mergeAsTextInContext(e.attr("listId"),r),d=i.serviceUrl+"rest/v1/"+"lists/"+n+"/leads.json",o={input:[{id:l}]},s=i.createHTTPRequest({url:d,method:"POST",headers:{"Content-Type":"application/json"},body:o});return i.makeRequest(s)}},"remove-lead-from-static-list":{label:"Remove a Person from Static List",builderProps:[{label:"Person ID",id:"personId",type:"string"},{label:"List ID",id:"listId",type:"string"}],runtimeExecution:function(e,t,r,i){var l=a.mergeAsTextInContext(e.attr("personId"),r),n=a.mergeAsTextInContext(e.attr("listId"),r),d=i.serviceUrl+"rest/v1/"+"lists/"+n+"/leads.json",o={input:[{id:l}]},s=i.createHTTPRequest({url:d,method:"DELETE",headers:{"Content-Type":"application/json"},body:o});return i.makeRequest(s)}}}},applyPaginationToken:function(e,t){"Lead"===t.dbType?e.url+="&nextPageToken="+t.value:"Asset"===t.dbType&&(e.url+="&offset="+t.value)},postSaveHook:function(e,t){var a,i,l=t.model,n=y.getModelMergeConditions(l,t).List,d=this.getEntityMetadataCacheKey(l),o="insert"===t.type,s=r(e.body).id;if("Person"===d&&n&&o&&s||d===u&&n&&o&&s)return a=s,i="lists/"+n+"/leads.json",S(l.dataSource,i,{input:[{id:a}]},!1)},getPaginationToken:function(e,t,a,i){var l=r(e&&e.body),n={};if("Lead"===i.dbType&&"Activity"!=a.objectName){if(l&&l.success&&l.nextPageToken&&l.result&&l.result.length===1+(0|i.recordsLimit))return n={dbType:i.dbType,value:l.nextPageToken},l.result.pop(),n}else if("Asset"===i.dbType&&l.result&&l.result.length===1+(0|i.recordsLimit))return n={dbType:i.dbType,value:i.offset-1},l.result.pop(),n},parseSuccessfulLoadResponse:function(e,t,i,l){var n=r(e.body),d=t.pathToContent,o=d?a.getObjectProperty(n,d):n;if(o=r(o),"Asset"===l.dbType&&o&&(l.offset?l.offset+=o.length:l.offset=o.length),n&&n.errors&&n.errors.length)throw"Model "+l.label+' had an error: "'+n.errors[0].message+'"';return y.safeEach(o,function(e,t){y.applySynonym(t,i)}),o},parseSuccessfulSaveResponse:function(e,t){if(e.body.errors&&e.body.errors[0])throw"Model "+t.model.label+' had an error: "'+e.body.errors[0].message+'"';var a=r(e.body);if(a.success){var i=a.result[0];if("skipped"===i.status){var l=i.reasons[0];throw"code: "+l.code+", "+l.message}return{id:a.result[0].id}}},getEntityList:function(e){var a=e.dataSource,r=t.map(g,function(e,t){return{value:t,label:t}});return S(a,E("Custom")).then(function(e){return r=r.concat(t.map(e,function(e){return{value:e.name,label:e.name}}))})},preLoadHook:function(a){var r,i,l,n,d=a.model,o=this.getEntityMetadataCacheKey(d);if("Person"===o||o===u){if(i=(r=y.getModelMergeConditions(d,a)).List,l=r.ProgramId,!(n=i||l))return;if((0|n)+""==n+"")return;var s=i?v:"ProgramId",p=(i?"lists.json?name=":"/rest/asset/v1/program/byName.json?name=")+n;return S(d.dataSource,p).then(function(e){if(!e.length)throw"Bad list condition passed for model: "+d.id;t.each(d.conditions,function(t,a){if(a.sourceParam===s)return a.value=e[0].id+"",!1})})}if("Activity"===o&&!d.paginationToken){n=y.getModelMergeConditions(d,a);var c="activities/pagingtoken.json?sinceDatetime="+function(t,a){try{var r=e.time.resolveDateKeyword(decodeURIComponent(a.dateTime))[0].toISOString()}catch(e){throw"Date must be of the format: LAST_N_WEEKS:10, for the model: "+t.id+" - Please reference the DataSource's documentation for more info on valid options."}return r}(d,n);return S(d.dataSource,c).then(function(e){if(d.tokenVal=e,!e.length)throw"Bad list condition passed for model: "+d.id})}},getExtendedModelProperties:function(t,a,r){var i=e.builder.core,l={basic:[],advanced:[],customTabs:[]};return"Person"!==t&&t!==u?l:(l.basic.push({id:"fetchby",type:"picklist",label:"Fetch Persons By",picklistEntries:[{label:"Static List",value:v},{label:"Program",value:"ProgramId"},{label:"Id",value:h}],defaultValue:v,helptext:"Persons can be fetched by Id, Static List, or Program",onChange:function(e){b.replaceConditions([I(e)],a),r.save().refresh().rebuildProps()}},i.getModelLimitProperty()),l)},queryEntityMetadata:function(e,a){var r=this.getEntityMetadataCacheKey(e);if(!r)return t.Deferred().reject("No Entity was selected for this Model.").promise();var l=function(e){var t={};switch(e){case"Campaign":t.idFields=["id"],t.label=e,t.labelPlural="Campaigns",t.fields=[{id:"id",label:"Campaign ID",displaytype:h},{id:"name"},{id:"type"},{id:"programName"},{id:"programId",displaytype:h},{id:"workspaceName"},{id:"createdAt",displaytype:n},{id:"updatedAt",displaytype:n},{id:"active",displaytype:d}],t.methods={query:{url:"campaigns/{{campaignId}}.json",verb:i.HTTP_VERBS.GET,contentType:f,pathToContent:"result"}},t.defaultConditions=[{sourcetype:"param",sourceparam:"campaignId",name:"campaignId",label:"Campaign ID",state:"filterableon",type:"fieldvalue",required:!0,value:""}];break;case"Program":t.idFields=["id"],t.label=e,t.labelPlural="Programs",t.fields=[{id:"id",label:"Program ID",displaytype:h},{id:"name",createable:!0,editable:!0},{id:"description",createable:!0,editable:!0},{id:"createdAt",displaytype:n},{id:"updatedAt",displaytype:n},{id:"url"},{id:"type",createable:!0},{id:"channel",createable:!0},{id:"sfdcId",label:"SFDC ID",displaytype:h},{id:"sfdcName",label:"SFDC Name"},{id:"status"},{id:"workspace"},{id:"folderType",synonym:"folder.type",label:"Folder Type",createable:!0},{id:"value",synonym:"folder.value",label:"Folder Id",createable:!0,displaytype:h},{id:"folderName",synonym:"folder.folderName",label:"Folder Name",createable:!0}],t.methods={query:{url:"program/byTag.json?tagType={{tagType}}&tagValue={{tagValue}}",verb:i.HTTP_VERBS.GET,contentType:f,pathToContent:"result"},update:{url:"program/{{id}}.json",verb:i.HTTP_VERBS.POST,contentType:"application/x-www-form-urlencoded"},insert:{url:"programs.json",verb:i.HTTP_VERBS.POST,contentType:f}},t.defaultConditions=[{sourcetype:"param",sourceparam:"tagType",name:"tagType",label:"Tag Type",state:"filterableon",type:"fieldvalue",required:!0,value:""},{sourcetype:"param",sourceparam:"tagValue",name:"tagValue",label:"Tag Value",state:"filterableon",type:"fieldvalue",required:!0,value:""},{sourcetype:"param",sourceparam:"id",name:"id",label:"Program Id",state:"filterableon",type:"fieldvalue",required:!0,value:""}];break;case"Folder":t.idFields=["id"],t.label=e,t.labelPlural="Folders",t.fields=[{id:"accessZoneId",displaytype:h},{id:"createdAt",displaytype:n},{id:"description"},{id:"metaFolderId",label:"Folder Id (Meta)",synonym:"folderId.id",displaytype:h},{id:"metaFolderType",label:"Folder Type (Meta)",synonym:"folderId.type"},{id:"folderType"},{id:"id",label:"Folder Id",displaytype:h},{id:"isArchive",displaytype:d},{id:"isSystem",displaytype:d},{id:"name"},{id:"parentId",synonym:"parent.id",label:"Parent Id",displaytype:h},{id:"parentType",synonym:"parent.type",label:"Parent Type"},{id:"updatedAt",displaytype:n},{id:"url"},{id:"workspace"}],t.methods={query:{url:"folders.json?maxDepth={{maxDepth}}",verb:i.HTTP_VERBS.GET,contentType:f,pathToContent:"result"}},t.defaultConditions=[{sourcetype:"param",sourceparam:"maxDepth",name:"maxDepth",label:"Max Folder Depth",state:"filterableon",type:"fieldvalue",required:!1}];break;case"StaticList":t.idFields=["id"],t.label=e,t.labelPlural="Lists",t.fields=[{id:"id",label:"List ID",displaytype:h},{id:"name"},{id:"description"},{id:"programName"},{id:"workspaceName"},{id:"createdAt",displaytype:n},{id:"updatedAt",displaytype:n}],t.methods={query:{url:"lists.json",verb:i.HTTP_VERBS.GET,contentType:f,pathToContent:"result"}},t.defaultConditions=null;break;case"Channel":t.idFields=["id"],t.label=e,t.labelPlural="Channels",t.fields=[{id:"applicableProgramType"},{id:"createdAt",displaytype:n},{id:"id",label:"Channel ID"},{id:"name"},{id:"updatedAt",displaytype:n}],t.methods={query:{url:"channel/byName.json?Name={{channelName}}",verb:i.HTTP_VERBS.GET,contentType:f,pathToContent:"result"}},t.defaultConditions=[{sourcetype:"param",sourceparam:"channelName",name:"channelName",label:"Channel Name",state:"filterableon",type:"fieldvalue",required:!1}];break;case"ActivityType":t.idFields=["id"],t.label=e,t.labelPlural="Activity Types",t.fields=[{id:"id",label:"Activity Type ID"},{id:"name"},{id:"apiName"},{id:"description"},{id:"primaryAttributeName",synonym:"primaryAttribute.name"},{id:"primaryAttributeDatatype",synonym:"primaryAttribute.dataType"}],t.methods={query:{url:"activities/types.json",verb:i.HTTP_VERBS.GET,contentType:f,pathToContent:"result"}},t.defaultConditions=null;break;case"Activity":t.idFields=["id"],t.label=e,t.labelPlural="Activities",t.fields=[{id:"id",label:"Activity ID",displaytype:h},{id:"activityDate",displaytype:n},{id:"activityTypeId",displaytype:h},{id:"campaignId",displaytype:h},{id:"leadId",label:"personId",displaytype:h},{id:"marketoGUID",displaytype:h},{id:"primaryAttributeValueId",displaytype:h},{id:"primaryAttributeValue"}],t.methods={query:{url:"activities.json?",verb:i.HTTP_VERBS.GET,contentType:f,pathToContent:"result"}},t.defaultConditions=[{sourcetype:"param",sourceparam:"personIds",name:"personIds",label:"Person ID",state:"filterableon",type:"fieldvalue",required:!0,value:""},{sourcetype:"param",sourceparam:"activityTypeIds",name:"activityTypeIds",label:"Activity Type ID",state:"filterableon",type:"fieldvalue",required:!0,value:""},{sourcetype:"param",sourceparam:"dateTime",name:"dateTime",label:"Date Time",state:"filterableon",type:"fieldvalue",required:!0,value:"LAST_N_WEEKS:10"}];break;case"Tag":t.idFields=["id"],t.label=e,t.labelPlural="Tags",t.fields=[{id:"applicableProgramTypes"},{id:"required",displaytype:d},{id:"tagType"}],t.methods={query:{url:"tagTypes.json",verb:i.HTTP_VERBS.GET,contentType:f,pathToContent:"result"}},t.defaultConditions=null;break;default:return t=null}return t.fields.forEach(function(e){e.label||(e.label=y.makeLabelFromId(e.id)),e.displaytype||(e.displaytype=s),e.editable||(e.editable=!1),e.creatable||(e.creatable=!1),e.accessible||(e.accessible=!0)}),t}(r);return l?y.deferrable(l):S(a.dataSource,E(r)).then(function(e){var a;if("Person"===r||r===u)a=function(e){return{fields:t.map(e,function(e){if(e.rest){var t={displaytype:C(e.dataType),label:e.displayName,id:e.rest.name,editable:!1===e.rest.readOnly,createable:!1===e.rest.readOnly,accessible:!0};return"id"===e.rest.name&&(t.omittable=!1,t.editable=!1,t.createable=!1,t.displaytype=o),t}}),idFields:["id"]}}(e);else if(g[r])a=k(e);else{if(!e.length)throw"Marketo did not recognize the entity: "+r;a=k(e[0])}var i={query:{url:"",verb:"GET",contentType:f,pathToContent:"result"}};"Person"!==r&&r!==u||(i.insert={url:"",verb:"POST",contentType:f},i.update={url:"",verb:"POST",contentType:f},i.delete={url:"",verb:"POST",successIf:"requestsucceeds"});var l=t.extend({label:r,labelPlural:r,methods:i},a);return"Person"===r||r===u?l.defaultConditions=[I(v)]:m(a,"searchableFields","length")&&(l.defaultConditions=[I("filterValues"),I("filterType",a)]),l})},getActions:y.getActionsStatic,extendedProperties:{composer:{unomittableFields:!0,hasEntityOptions:!0,rebuildPropsOnSelectEntity:!0}}})}(skuid)}});