!function(e){var t={};function r(o){if(t[o])return t[o].exports;var a=t[o]={i:o,l:!1,exports:{}};return e[o].call(a.exports,a,a.exports,r),a.l=!0,a.exports}r.m=e,r.c=t,r.d=function(e,t,o){r.o(e,t)||Object.defineProperty(e,t,{configurable:!1,enumerable:!0,get:o})},r.r=function(e){Object.defineProperty(e,"__esModule",{value:!0})},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=313)}({313:function(e,t,r){"use strict";!function(e){var t=e.$,r=e.utils,o=r.makeXMLDoc,a=r.mergeAsTextInContext,n=e.dataSource.utils,i=t.Deferred,u=function(e){return"SkuidSharepoint-"+e+"-Login-"},s=function(e){if(!e)return"Error";var t=e.body,r=o(t).children("m\\:code").first().text().split(",");return r[1]&&r[1].trim&&r[1].trim()},c=function(e){var r=t.Deferred(),o=e.dataSource,a=function(){var e=o.authentication;return"apex"===e.authMethod&&"Sharepoint_SharedLogin"===e.providerName},n=u(o.name);return!o.isAuthenticated()&&a()&&t.cookie(n+"FedAuth")&&t.cookie(n+"rtFa")&&t.cookie(n+"Digest")&&(o.authentication.success=!0),o.authenticate().done(function(){o.isAuthenticated()&&a()&&(e.headers||(e.headers={}),t.cookie.raw=!0,e.headers.Cookie="FedAuth="+t.cookie(n+"FedAuth")+"; rtFa="+t.cookie(n+"rtFa")+";",e.headers["X-RequestDigest"]=t.cookie(n+"Digest"),t.cookie.raw=!1),r.resolve(e)}).fail(function(e){!function(e){if(e){var r=u(e.name);t.removeCookie(r+"FedAuth"),t.removeCookie(r+"rtFa"),t.removeCookie(r+"Digest"),e.authentication.success=!1,e.removeStoredAuthData()}}(o),r.reject(e)}),r.promise()};e.dataSource.getType("Sharepoint")||new e.dataSource.core.ODataDataSourceTypeBase({name:"Sharepoint",getKeyFields:function(e){var r,o={},a=e.key;return t.isArray(a)&&(a=a[0]),a&&a.propertyRef&&(r=a.propertyRef[0].name,"Edm.Boolean"===e.propertyMap[r].type&&(a.propertyRef[0].name="ID"),t.each(a.propertyRef,function(e,t){o[t.name]={id:t.name}})),o},getEntityContainerToList:function(){return"ListData"},supportsBatch:function(){return t.Deferred().resolve(!0).promise()},authenticateAndGetMetadata:function(e){var t=this;return c(e).then(function(){return t.getMetadata(e)})},isDefFilterable:function(e){return"Edm.String"===e.type&&"BaseName"!==e.name},coerceEntitySetList:function(e){e.push("SP.Files")},getUploadMethods:function(){return{relative_server_url:{label:"Relative Server URL",upload:function(o,i,u,d,l,f){var p,h,m=encodeURIComponent(r.renameFileWhileKeepingExtension(o.name,a(u.filename,u))),v=u.uploadMethod.dataSource,y=v&&v.serviceUrl?v.serviceUrl:"",b={row:i.row,model:i.model},g=i.options.xmlDef.attr("foldername"),S=g?n.mergeThenURLEncode(g,b,{createFields:!1}):encodeURIComponent("/Shared Documents"),k="/web/getfolderbyserverrelativeurl('"+S+"')/files/getbyurl('"+m+"')/",R=r.rfc4122v4GUID(),T=o.size,x=e.platform.getMaxProxyRequestPayload(),D=1;function F(e){if(e&&e.body){try{var t=JSON.parse(e.body)}catch(e){return s(e)}if(t&&t.error&&t.error.message&&t.error.message.value)return t.error.message.value}return"Had an error"}function U(e,r){r||(r={});var a=(r=t.extend({overwrite:!1},r)).overwrite;d({fileName:u.filename||o.name});var n=y+"/web/getfolderbyserverrelativeurl('"+S+"')/files/add(overwrite="+a+",url='"+m+"')",i=v.createHTTPRequest({url:n,headers:u.headers,method:"POST",contentType:"application/octet-stream",body:e});return v.makeRequest(i)}function w(){f({loaded:D,total:p});var e=y+k+"startupload(uploadId=guid'"+R+"')",t=v.createHTTPRequest({url:e,headers:u.headers,method:"POST",contentType:"application/octet-stream",body:h[0]});return v.makeRequest(t).then(function(e){P(e)},function(e){l({message:F(e)})})}function P(e){var t=JSON.parse(e.body).d,r=t.StartUpload?parseInt(t.StartUpload):parseInt(t.ContinueUpload);f({loaded:++D,total:p}),c(u).then(function(){if(u.headers.Accept="application/json; odata=verbose",D===p)!function(e){var t=y+k+"finishupload(uploadId=guid'"+R+"',fileOffset="+e+")",r=v.createHTTPRequest({url:t,headers:u.headers,method:"POST",contentType:"application/octet-stream",body:h[D-1]});v.makeRequest(r).then(function(){l()},function(e){l({message:F(e)})})}(r);else{var e=y+k+"continueupload(uploadId=guid'"+R+"',fileOffset="+r+")",t=v.createHTTPRequest({url:e,headers:u.headers,method:"POST",contentType:"application/octet-stream",body:h[D-1]});v.makeRequest(t).then(P,function(e){l({message:F(e)})})}})}T&&(u.dataSource=v,u.headers=u.headers||{},u.headers["skuid-base64-body"]=!0,r.readFileAsBase64(o).then(function(e){h=e,1===(p=Math.ceil(T/x))?c(u).then(function(){U(h,{overwrite:!0}).then(function(){l()},function(e){l({message:F(e)})})}):c(u).then(function(){h=function(e,t){for(var r=e.length,o=[],a=Math.ceil(r/t),n=0;n<t;n++)o[n]=e.slice(a*n,a*(n+1));return o}(h,p),u.headers.Accept="application/json; odata=verbose",U("42",{overwrite:!1}).then(w,function(e){var t=F(e);t.includes("already exists")?w():l({message:t})})})}))},hasDescription:!1,hasParent:!1,builderProps:[{id:"foldername",type:"text",label:"Relative folder URL",defaultValue:"/Shared Documents",helptext:'This is the relative server url for the folder you want this file to be uploaded to. Example: "/Shared Documents/SubFolder1/SubFolder2"'}]}}},getActions:n.getActionsStatic,createActions:function(e){return{"download-file":{builderProps:[{label:"File URL",id:"key",type:"template",location:"attribute",defaultValue:"{{Url}}"},{label:"Name of File",id:"name",type:"template",location:"attribute",defaultValue:"{{Name}}"}],runtimeExecution:function(t,o,u){u=u||{};var s=i(),c=n.mergeThenURLEncode(t.attr("key")||"{{Url}}",u),d=a(t.attr("name")||"{{Name}}",u),l=function(e,t){return-1!==e.indexOf("_api")&&(e=e.substring(0,e.indexOf("_api"))),r.combineUrls(e,"_layouts/download.aspx?SourceUrl=")+t}(e.serviceUrl,c);return d&&c?(n.downloadWithLink(d,l),s.resolve().promise()):s.reject().promise()},label:"Download File"}}}})}(skuid)}});