!function(e){var t={};function n(i){if(t[i])return t[i].exports;var a=t[i]={i:i,l:!1,exports:{}};return e[i].call(a.exports,a,a.exports,n),a.l=!0,a.exports}n.m=e,n.c=t,n.d=function(e,t,i){n.o(e,t)||Object.defineProperty(e,t,{configurable:!1,enumerable:!0,get:i})},n.r=function(e){Object.defineProperty(e,"__esModule",{value:!0})},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=1770)}({1770:function(e,t,n){"use strict";var i,a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},r=n(40),o=(i=r)&&i.__esModule?i:{default:i};!function(e){var t=e.$,n=t.each,i=t.extend,r=e.constants,l=e.dataSource,u=r.DISPLAY_TYPES,c=l.core||(l.core={}),d=e.utils,s=d.isString,f=t.Deferred,h=["name"],p="x-sql-dialect";function g(e){var t=e.body;if(t)for(;s(t);)try{t=JSON.parse(t)}catch(e){break}return t}var y={getEntityList:function(e,t){return{url:d.combineUrls(t.dataServiceUrl,"datasources/"+t.id+"/entities"),method:"GET",contentType:"application/json",headers:{}}},getModelMetadata:function(e,t){return{url:d.combineUrls(t.dataServiceUrl,"datasources/"+t.id+"/entities?name="+e.entity),method:"GET",contentType:"application/json",headers:{accept:"application/vnd.skuid-metadata"}}},load:function(e,t){return{url:d.combineUrls(t.dataServiceUrl,"datasources/"+t.id+"/load"),method:"POST",contentType:"application/json",body:e}},save:function(e,t){return{url:d.combineUrls(t.dataServiceUrl,"datasources/"+t.id+"/save"),method:"POST",contentType:"application/json",body:e}}};function v(n){for(var i,a={},r=n.getDataSourceType(),l=function(i){return function(a){if(n.proxyHost&&n.proxyPort)return function(e,n,i){return o.default.getAPIToken().then(function(a){var r=y[e](n,i);return r.headers=t.extend({},{"x-skuid-options-schemas":!0,Authorization:"Bearer "+a.jwt},r.headers),r})}(i,a,n).then(function(i){return e.ajax.direct(n.createHTTPRequest(i)).then(g).catch(function(e){var n,i=g(e);return i&&t.isPlainObject(i)&&(n=i.message),n||(n=e.status),n})});var l=f(),u=function(t,n,i,a){var r=i.useDataSourceObjects?i.dataServiceUrl:a.remoteEndpoint,o=n?"POST":"GET",l={method:o,url:d.combineUrls(r,t)};return"POST"===o&&(l.body=n,l.contentType="application/json"),l.headers={"x-skuid-data-source":i.name,"x-skuid-options-schemas":!0},a.sendSessionIdAsHeader&&(l.headers["x-skuid-session-id"]=e.utils.userInfo.sessionId),a[p]&&(l.headers[p]=a[p]),l}(i,a,n,r);return e.ajax.direct(n.createHTTPRequest(u)).then(function(e){l.resolve(g(e))},function(e){var n,i=g(e);i&&t.isPlainObject(i)&&(n=i.message),n||(n=e.status),l.reject(n)}),l.promise()}},u=0,c=["load","save","getModelMetadata","getEntityList"];u<c.length;u++)a[i=c[u]]=l(i);return n._remote=a,a}function b(e){var t=e._remote;return t||(t=new v(e)),t}function m(e,t,n){t||(t=n.getDataSource());var i=t.getCachedEntityMetadata(e),a=i&&i.get("nameFields");if(a&&a.length)return a[0]}function T(e){var n=e.idFields;return n&&t.isArray(n)&&1===n.length?n[0]:n}function F(e){var n,i,a,r;e.rel||(e.rel=e.id+"__rel"),e.relationshipName||(e.relationshipName=e.rel),!e.ref&&e.referenceTo&&(n=e.referenceTo)&&n.length&&(i=[],a=[],r={c:"createable",o:"objectName",l:"label",k:"keyPrefix",p:"labelPlural",s:"searchable"},t.each(n,function(e,n){n.o?(i.push(n.o),a.push(n.k),t.each(r,function(e,t){n[t]=n[e],delete n[e]}),n.accessible=!0):(i.push(n.objectName),n.accessible=!0)}),i.length&&(e.ref=i.join(",")),a.length&&(e.refprefix=a.join(",")))}function M(e){return d.grab(e,"referenceTo",0,"keyField")}function S(e){return e&&e.slice(0,-5)}function P(e){return e&&e+"__rel"}function j(e){!function(e){t.each(e,function(e,t){if(!t.fields||!t.fields.length)throw"Error with Model: "+t.id+" - Must have at least one valid field"})}(e),function(e){t.each(e,function(e,n){if(!n.conditions||!n.conditions.length)return delete n.conditions,void delete n.conditionLogic;var i=!1;t.each(n.conditions,function(e,t){t.inactive||(i=!0)}),i||(delete n.conditions,delete n.conditionLogic)})}(e)}function E(e){return d.isString(e)||e.objectName&&e.dataSource}function N(e){n(h,function(t,n){if(!e[n])throw"Missing Required Property Error: "+n}),i(this,e),e.extendedProperties&&(i(!0,this.properties,e.extendedProperties),delete this.extendedProperties),l.DataSourceType.prototype.constructor.call(this,this),delete this.getModelProperties}N.prototype=new l.DataSourceType(!1),N.constructor=N,N.prototype=i(!0,N.prototype,{save:function(e,t){var n=t.dataSource;return n.authenticate().then(function(){return b(n).save(e)})},load:function(e,n){var i=n.dataSource;return i.authenticate().then(function(){var a=!1,r=["conditionLogic","doQuery","groupByMethod","havingLogic","id","objectName","schemaName","orderByClause","offsetPageNumber","offsetPageSize","recordsLimit","type"],o={},l=t.map(e,function(e){var n={};for(var i in e)e.hasOwnProperty(i)&&t.inArray(i,r)>-1&&(d.isUndefined(e[i])||""===e[i]||(n[i]=e[i]));var l=e.fields.filter(function(e){return e.uiOnly});return l.length&&(o[e.id]=l),t.each(["fields","groupByFields"],function(i,a){var r,o=e[a];o&&o.length&&(r=n[a]=[],t.each(o,function(e,n){var i;if(n.uiOnly)return!0;"childRelationship"===n.type?(i={id:n.id,type:n.type,anchorField:n.anchorField,keyField:n.keyField,childObject:n.childObject},t.each(["recordsLimit","orderByClause","subConditionLogic"],function(e,t){n.hasOwnProperty(t)&&null!==n[t]&&void 0!==n[t]&&(i[t]=n[t])}),n.subConditions&&(i.subConditions=[],n.subConditions.length&&t.each(n.subConditions,function(e,t){var n={};for(var a in t)t.hasOwnProperty(a)&&null!==t[a]&&void 0!==t[a]&&(n[a]=t[a]);i.subConditions.push(n)})),n.subFields&&(i.subFields=[],n.subFields.length&&t.each(n.subFields,function(e,t){var a={id:t.id};void 0!==n.query&&null!==n.query&&(a.query=a.query),i.subFields.push(a)}))):(i={id:n.id},t.each(["name","function","query"],function(e,t){n.hasOwnProperty(t)&&null!==n[t]&&(i[t]=n[t])})),r.push(i)}))}),t.each(["conditions","havings"],function(i,a){var r,o=e[a];o&&o.length&&(r=n[a]=[],t.each(o,function(n,i){var a=t.extend({},i);for(var o in a)null===a[o]&&delete a[o];t.each(a.subConditions,function(t,n){var i=e.getField(n.field);["INTEGER","DOUBLE","CURRENCY"].indexOf(i.displaytype)>-1&&(n.operator="=")}),r.push(a)}))}),e.needsMetadataLoad&&(a=!0),n});j(l);var u=!n||n.loadAllMetadata||a;return b(i).load({operationModels:l,options:{excludeMetadata:!u}}).then(function(e){var n,a,r=f();return t.isArray(e)?r.resolve(e):e&&e.models?((n=e.metadata)&&d.size(n)&&t.each(n,function(e,t){i.cacheEntityMetadata(e,t)}),Object.keys(o).length&&(e.models=(a=o,e.models.map(function(e){return e.fields&&a[e.id]&&(e.fields=e.fields.concat(a[e.id])),e}))),r.resolve(e.models)):r.reject("Invalid Response Format"),r.promise()})})},getRowId:function(e,n){var i,a=T(n),r={},o=!1;return t.isArray(a)?(a.length<=0&&(o=!0),a.forEach(function(t){var i=n.getFieldValue(e,t,!0);d.isUndefined(i)||null===i?o=!0:r[t]=i})):(i=n.getFieldValue(e,a,!0),d.isUndefined(i)||null===i?o=!0:r[a]=i),o?d.generateUniqueId():JSON.stringify(r)},getChildIdFromRow:function(e,t,n){var i=e.getIdFieldForChildRelationship(n),a=t[i],r=null;if(i&&a){var o={};o[i]=a,r=d.encodeHTML(JSON.stringify(o))}return r},getReferenceHandler:function(){return{getReferenceValue:function(e,t){return e[M(t)]},processReferenceLookupModel:function(e,t,n){var i=M(t.metadata),a=m(n,null,e);e.objectName=n,e.fields||(e.fields=[]),e.fields.push({id:i}),a&&!e.getField(a)&&e.fields.push({id:a})},getRowFromReferenceValue:function(e,t,n){var i=M(n),a=e.getRows([{field:i,value:t}]);return a&&a.length?a[0]:{}}}},getRowName:function(e,t,n){return t.getFieldValue(e,m(t.objectName,n,t),!0)},getNameField:m,getIdField:T,getIdFieldForChildRelationship:function(e,t){return T(e.fieldsMap[t])},initialize:function(e){if(e.fields&&e.fields.length){var n=e.getDataSource&&e.getDataSource(),i=n&&n.getCachedEntityMetadata(e.objectName);i&&(t.each(e.fields,function(n,a){!function e(n,i,a,r){if(i){var o,l,c,d,s,f,h=i.split("."),p=r.getDataSource&&r.getDataSource();if("childRelationship"===n.type)(d=n.referenceTo&&n.referenceTo.length&&n.referenceTo[0])&&(s=p&&p.getCachedEntityMetadata(d.o),n.idFields=s.get("idFields"),(f=n.subFields)&&t.each(f,function(t,n){e(n,n.id,s,r)}));else if(1===h.length){if(o=a&&a.getField&&a.getField(i)){l=r.getOverrideableFieldMetadata(n);var g=n.id,y=n.name;t.extend(!0,n,o),g&&(n.id=g),y&&(n.name=y),l&&t.each(l,function(e,t){n[e]=t})}n&&n.displaytype===u.REFERENCE&&F(n)}else i=S(i=h.shift()),(o=a&&i&&a.getField&&a.getField(i))&&((c=o.referenceTo)&&1===c.length?a=p&&p.getCachedEntityMetadata(c[0].objectName||c[0].o):c&&c.length>1&&(a=p&&p.getCachedEntityMetadata("Name")),a&&e(n,h.join("."),a,r)),n.required=n.createable=n.editable=!1}}(a,a.id,i,e)}),t.each(i.get(["label","labelPlural"]),function(t,n){e.hasOwnProperty(t)||(e[t]=n)}),t.each(i.get(["accessible","createable","updateable","deleteable","idFields"]),function(t,n){e[t]=n}))}return(!e.idFields||e.idFields&&!e.idFields.length)&&(e.updateable=!1,e.deleteable=!1),e.data instanceof Array||(e.data=[e.data]),e},getEntityList:function(e){var n=e.dataSource;return n._entityListCache?f().resolve(n._entityListCache):n.authenticate().then(function(){return b(n).getEntityList()}).then(function(e){return n._entityListCache=e.map(function(e){return t.isPlainObject(e)?{label:e.label,value:e.name}:e}),n._entityListCache})},handleDefaultReferenceFieldValue:function(e,n,i,r,o){var l=r.rel,u=n.value,c=d.getNameField(r.ref,i.dataSource),s=n.nameFieldValue||!1;if(!s){var f=d.getFieldReference(n.field,r,i.dataSource);t.each(o,function(e,t){t===n||t.field!==f||t.inactive||!t.value||n.operator&&"="!==n.operator||(s=t.value)})}var h,p={};s&&("object"===(void 0===s?"undefined":a(s))?h=s:(h={})[c]=s,p[l]=h),p[n.field]=u,i.updateRow(e,p)},getReferenceFieldRelatedData:function(n,i,a,r,o){var l,u=n.id,c=P(u);if(void 0===o[c]){if(t.each(r.data,function(){if(this[u]&&this[u]===i&&r.getFieldValue(this,c))return l=r.getFieldValue(this,c,!0),!1}),!l){var d=r.dataSource&&r.dataSource.name,s=n.referenceTo,f=[],h=[];s&&s.length&&t.each(s,function(){f.push(this),h.push(this.objectName)}),t.each(e.model.getModelsByDataSource(d),function(){var e=this,n=[];if(e!==r&&-1!==h.indexOf(e.objectName))return t.each(this.fields,function(){var e=this;t.each(f,function(t,i){i.keyField===e.id&&n.push(e)})}),n.length&&t.each(e.getRows(),function(){var a=this;if(t.each(n,function(){if(e.getFieldValue(a,this.id,!0)===i)return l=a,!1}),l)return!1}),!l&&void 0})}return l}},buildEntityMetadataRequest:function(e){var t=e.targetEntity;return!t&&e.model&&e.model.attr&&(t=e.model.attr("sobject")),{objectName:t}},getEntityMetadataLoadingMessageFromBreadcrumb:function(e){return"Loading metadata for table "+e.endsobject+"..."},getEntityMetadataCacheKey:function(e){return e.objectName},getEntityMetadata:function(e){var n=e.entities,i=e.dataSource;return function(e){if(e){if(t.isArray(e)){var n=!0;return t.each(e,function(){if(!E(this))return n=!1,!1}),n}if(t.isPlainObject(e))return E(e);if(d.isString(e))return!0}return!1}(n)?i.authenticate().then(function(){var e=t.map(n,function(e){var n=s(e)?e:e.objectName,a={entity:n,loadChildRelationships:!0,loadPicklistValues:!1};return n?(e&&e.fields&&e.fields.length&&(a.fieldsToLoad=e.fields.join(",")),b(i).getModelMetadata(a).then(function(e){return t.isArray(e)&&(e=e[0]),e.fields&&e.fields.length&&t.each(e.fields,function(e,n){var a=t.map(n.referenceTo,function(e){return e.objectName}).filter(function(e){return!(e in i.getCachedEntityMetadata())}),r=t.map(n.childRelations,function(e){return e.childObject}).filter(function(e){return!(e in i.getCachedEntityMetadata())});a.concat(r).length>0&&i.getEntityMetadata({entities:a,dataSource:i,ignoreMetadataOverrides:!0}).then(function(e){i.cacheEntityMetadata(i.getEntityMetadataCacheKey(e),e)}),F(n)}),e})):f().reject("No Table Name provided")});return t.when.all(e).catch(function(e){return f().reject(e&&e.length?e.join(","):"")})}):f().reject("Invalid Model configuration. Metadata could not be retrieved.")},getModelProperties:function(t,n){var i=e.builder.core,a=t.state,r=i.getUnsavedChangesWarningProperty({component:t}),o=i.getCoreModelBasicProperties({component:t,propViewer:n}),l=[];return o.push({id:"sobject",type:"sobject",dataSourceTypeName:this.name,dataSourceName:a.attr("datasource"),label:"Entity Name",onChange:function(e){if(e&&(!a.attr("label")||!a.attr("labelplural"))){var n=d.capitalizeFirst(e.split(".").pop());a.attr("label")||a.attr("label",n),a.attr("labelplural")||a.attr("labelplural",n+(d.endsWith(n,"s")?"":"s")),t.save()}}}),o.push(i.getModelTypeProperty({component:t}),i.getModelQueryOnPageLoadProperty({component:t,propViewer:n}),i.getModelLimitProperty(),i.getModelOrderByProperty(),i.getCreateDefaultRowProperty(),i.getModelNameFieldProperty()),r&&l.push(r),Array.prototype.push.apply(l,i.getModelLabelProperties()),[{name:"Basic",props:o},{name:"Advanced",props:l}]},getAggregateFieldProperties:function(t,n){var i=t.state,a=e.builder.core;return[{id:"function",type:"picklist",label:"Function",helptext:"The Aggregation function to use",defaultValue:"SUM",required:!0,picklistEntries:[{label:"COUNT",value:"COUNT"},{label:"COUNT DISTINCT",value:"COUNT_DISTINCT"},{label:"SUM",value:"SUM"},{label:"AVG",value:"AVG"},{label:"MAX",value:"MAX"},{label:"MIN",value:"MIN"}],onChange:function(e){e&&i.attr("name",a.getDefaultAliasName(i.attr("id"),e)),t.save().refresh().rebuildProps(n)}}]},getAggregateGroupingProperties:function(){return[]},getReferenceFieldNameFromRelationshipField:S,getReferenceFieldRelationshipName:P,joinFieldDisplayTypeFilter:function(e){if(e)return!0},properties:{composer:{supports:{childRelationships:!0},canFieldsBeSelected:function(e){return!!e.breadcrumb.endsobject||"Select an entity to use for this Model"}},batchableEntityRequests:!0,serverSideModelMerge:!0,canAutoGenerateConditionsFromFields:!0,canConditionsBeGrouped:!0,validConditionTypes:["blank","fieldvalue","join","modelmerge","multiple","param","userinfo"]},searchableDisplayTypes:{INTEGER:1,DOUBLE:1,CURRENCY:1,ID:1,STRING:1,TEXT:1,EMAIL:1,PICKLIST:1,MULTIPICKLIST:1,COMBOBOX:1,PHONE:1,URL:1,REFERENCE:1,TEXTAREA:1}}),i(c,{RelationalDataSourceTypeBase:N})}(skuid)},40:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}();var a=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}return i(e,[{key:"refreshAPIToken",value:function(){var e=this;return skuid.platform.services.getToken().then(function(t){var n=t.token,i=e.extractJWTPayload(n).exp;return e.apiToken={expiration:i,jwt:n}})}},{key:"extractJWTPayload",value:function(e){var t=e.split(".");if(3!=t.length)throw new Error("JWT not formatted correctly");return JSON.parse(atob(t[1]))}},{key:"getAPIToken",value:function(){var e=this.apiToken;return e&&this.isValid(e)?skuid.utils.resolve(e):this.refreshAPIToken()}},{key:"isValid",value:function(e){var t=void 0;return(t=skuid.utils.isString(e)?this.extractJWTPayload(e).exp:e.expiration)&&t>Date.now()/1e3}}]),e}();t.default=new a}});