!function(e){var t={};function n(i){if(t[i])return t[i].exports;var o=t[i]={i:i,l:!1,exports:{}};return e[i].call(o.exports,o,o.exports,n),o.l=!0,o.exports}n.m=e,n.c=t,n.d=function(e,t,i){n.o(e,t)||Object.defineProperty(e,t,{configurable:!1,enumerable:!0,get:i})},n.r=function(e){Object.defineProperty(e,"__esModule",{value:!0})},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=1592)}({1592:function(e,t,n){"use strict";n(302)},302:function(e,t,n){"use strict";!function(e){var t=e.builder.mobile={},n=e.$,i=e.utils,o=i.makeXMLDoc,r=e.builder.core,s=e.mobile,a=e.events.subscribe,d=e.events.publish,l=e.componentType.register,p=e.componentType.get;r.addValidActionOptions([{value:"-",label:"Visual navigation",disabled:!0},{value:"setLeftPanel",label:"Set Left Panel"},{value:"toggleLeftPanel",label:"Toggle Left Panel"},{value:"hideLeftPanel",label:"Hide Left Panel"},{value:"setMainPanel",label:"Set Main Panel"},{value:"setPopupPanel",label:"Set Popup Panel"},{value:"hidePopupPanel",label:"Hide Popup Panel"},{value:"blockUI",label:"Show message and block UI"},{value:"unblockUI",label:"Unblock the UI"},{value:"redirect",label:"Go to URL"},{value:"toggleSetupMenu",label:"Toggle Setup Menu"}]),r.addValidActionOptions(r.getCoreActionOptions()),t.model,t.row,t.pageXML,t.mobileXML,t.resourcesXML,t.componentViewer,t.propertyViewer,t.makeAddComponentsCategory=function(e){return{label:(e=e||{}).label||"Add Components",props:[{type:"validcomponents",childrenNodeName:e.childrenNodeName}]}},t.makeDraggableComponent=function(e,i){e.draggable({handle:".smb-component-gripper",appendTo:s.panelarea,delay:100,helper:function(){var e=n("<div>").addClass("smb-component-draghelper");return e.append(n("<div>").text(i.name)),e},scroll:!0,revert:"invalid",start:function(){e.addClass("smb-component-dragging");var i=n(this).data("ui-draggable");i.scrollParent=t.componentViewer.element,i.overflowOffset=i.scrollParent.offset()},stop:function(){e.removeClass("smb-component-dragging")},scrollSensitivity:60,scrollSpeed:10,drag:function(e,t){var i=n(this).data("ui-draggable"),o=i,r=o.options,s=!1;t.position.top-=o.scrollParent[0].scrollTop,o.overflowOffset.top+o.scrollParent[0].offsetHeight-e.pageY<r.scrollSensitivity?o.scrollParent[0].scrollTop=s=o.scrollParent[0].scrollTop+r.scrollSpeed:e.pageY-o.overflowOffset.top<r.scrollSensitivity&&(o.scrollParent[0].scrollTop=s=o.scrollParent[0].scrollTop-r.scrollSpeed),s&&n.ui.ddmanager.prepareOffsets(i,e)},cursorAt:{right:10,top:10}})},t.FieldSelectDeck=function(t,i){var o=this;if(t||(t=n("<div>")),o.breadcrumb=i.breadcrumb,!o.breadcrumb)return!1;if(o.options=i,o.element=t,t.addClass("smb-fielddeck nx-list-contents sm-grid"),t.off(),t.on("tap",".smb-fieldcard",function(e){e.stopPropagation()}),t.on("tap",".smb-fieldcard-inmodel",function(){var e=n(this).closest(".smb-fieldcard").data("card");e.component&&e.component.select&&e.component.select()}),t.on("hold",".smb-fieldcard",function(e){n(this).closest(".smb-fieldcard").data("card").toggleSelect(),e.stopPropagation()}),t.on("tap",".smb-fieldcard-toggle",function(e){n(this).closest(".smb-fieldcard").data("card").toggleSelect(),e.stopPropagation()}),t.on("tap",".smb-fieldcard-referencelink",function(e){var t=n(this).closest(".smb-fieldcard").data("card");o.followReference(t.fielddata),e.stopPropagation()}),i.controls){o.subcontrolwrapper=n("<div>").addClass("smb-fielddeck-subcontrol"),o.breadcrumbwrapper=n("<div>").addClass("smb-breadcrumb-wrapper"),o.quickletterwrapper=n("<div>").addClass("smb-quickletter-wrapper");var r=n("<div>").addClass("smb-fielddeck-search-wrapper"),s=n("<div>").addClass("smb-fielddeck-selected-wrapper");if(i.showSelectedFilter){var a=n("<div>").addClass("smb-fielddeck-selected-toggle").text("S").on("tap",function(){o.selectedOnly=!o.selectedOnly,n(this).toggleClass("active"),o.render()});s.append(a)}else s.hide(),o.subcontrolwrapper.addClass("nofilter");o.searchBox=e.ui.renderers.TEXT.edit({onChange:function(e){o.searchtext=e,o.render()}}).css("padding","3px 6px"),r.append(o.searchBox),o.subcontrolwrapper.append(o.breadcrumbwrapper,o.quickletterwrapper),i.controls.append(r,s,o.subcontrolwrapper),o.breadcrumbwrapper.on("tap",".nx-pagebuilder-breadcrumb-link",function(){o.breadcrumb=o.breadcrumb.slice(0,n(this).index()+1),o.render()})}},t.FieldSelectDeck.prototype.render=function(){var i=this,o=n.Deferred();return i.element.empty(),n.when(r.processBreadCrumbInfo(i.breadcrumb)).fail(function(e){o.reject(e)}).done(function(a){if(!a.endsobject)return i.element.append(n("<div>").addClass("smb-fielddeck-error").text("Select an SObject for this Model.")),void o.reject("Select an SObject for this Model");var d=i.options.controls,l=a.endsobject;d&&(i.breadcrumbwrapper.empty(),i.breadcrumbwrapper.append(a.elements)),i.options.prefix=a.prefix;var p,c=e.dataSource.getDataSource("salesforce"),u={objectName:l};a.prefix&&(u.objectName=a.endsobject,u.path=a.prefix),p="Loading metadata for object "+l+"...",n.blockUI({message:p}),n.when(c.getEntityMetadata({entities:u,ignoreMetadataOverrides:!0})).fail(function(e){n.blockUI({message:"There was an error retrieving metadata: "+e,timeout:2e3})}).done(function(o){var l=n.merge([],o.getSortedFieldsList()),p=i.options.getUiOnlyFields;p&&!a.prefix&&(p=p())&&p.each(function(){var e=n(this),t=e.attr("id");l.push({id:t,label:r.getModelFieldComponentLabel(e)||t+" (Ui-Only)",displaytype:e.attr("displaytype"),destroyCardOnUnselect:!0})}),n.each(l,function(){if(i.searchtext){var e=-1!==this.id.toLowerCase().indexOf(i.searchtext.toLowerCase()),n=-1!==this.label.toLowerCase().indexOf(i.searchtext.toLowerCase());if(!e&&!n)return!0}return!(!i.options.filter||i.options.filter(this,a.prefix))||(!(!i.selectedOnly||!i.options.isSelected||i.options.isSelected(this,a.prefix))||void i.element.append(new t.FieldSelectCard(this,i.options).element))}),e.responsive.prepareGrid(i.element,{precision:"10",layoutMode:"rigid",minWidth:"160"}),s.processResponsiveArea(i.element),d.find(":input").focus(),n.unblockUI()})}),o.promise()},t.FieldSelectDeck.prototype.followReference=function(e){var t={rel:e.rel,ref:e.ref,isPolymorphic:!1};this.searchBox.val(""),this.searchtext="",this.breadcrumb.push(t),this.render()},t.FieldSelectCard=function(t,i){this.fielddata=t,this.deckoptions=i,this.element=n("<div>").addClass("smb-fieldcard sm-card sm-grid-division"),this.element.data("card",this),this.body=n("<div>").addClass("smb-fieldcard-inner"),this.fieldCardTitle=n("<div>").addClass("smb-fieldcard-title"),this.fieldCardBody=n("<div>").addClass("smb-fieldcard-body"),this.fieldCardToggle=n("<div>").addClass("smb-fieldcard-toggle fa fa-fw");var o=n("<div>").addClass("smb-fieldcard-referencelink fa fa-fw fa-external-link");this.fieldReferenceCount=n("<div>").addClass("smb-fieldcard-referencecount"),this.body.append(this.fieldCardTitle,this.fieldCardBody,this.fieldCardToggle);var r=t.displaytype;this.fieldCardTitle.text(t.label),"REFERENCE"===t.displaytype&&"null"!==t.rel&&t.referenceTo&&t.referenceTo.length&&(this.body.append(o),this.deckoptions.referenceCount&&(this.updateReferenceCount(),this.body.append(this.fieldReferenceCount)),r="REF"),this.fieldCardBody.text(r),e.responsive.prepareDivision(this.element,{relativeSize:"1",minWidth:"160"}),this.setSelect(),this.element.append(this.body)},t.FieldSelectCard.prototype.updateReferenceCount=function(){this.fieldReferenceCount.text(this.deckoptions.referenceCount(this.fielddata,this.deckoptions.prefix))},t.FieldSelectCard.prototype.isSelected=function(){return this.deckoptions.isSelected&&this.deckoptions.isSelected(this.fielddata,this.deckoptions.prefix)},t.FieldSelectCard.prototype.toggleSelect=function(){this.isSelected()?this.deckoptions.onUnselect&&this.deckoptions.onUnselect(this.fielddata,this.deckoptions.prefix,this):this.deckoptions.onSelect&&this.deckoptions.onSelect(this.fielddata,this.deckoptions.prefix,this),this.setSelect()},t.FieldSelectCard.prototype.setSelect=function(){this.isSelected()?(this.body.addClass("smb-fieldcard-inmodel"),this.fieldCardToggle.addClass("fa-times").removeClass("fa-check"),this.component=new t.Component(this.deckoptions.getFieldXML(this.fielddata,this.deckoptions.prefix)).render(),this.component.card=this):!0===this.fielddata.destroyCardOnUnselect?this.element.detach():(this.body.removeClass("smb-fieldcard-inmodel"),this.fieldCardToggle.addClass("fa-check").removeClass("fa-times"))};t.propertyRenderers={helptext:function(e){e.element.append(n("<div>").addClass("smb-proptertyitem-helparea").html(e.html))},field:function(e,i){var o,a,d,l=n("<div>").addClass("sm-field-label").text(e.label),p=r.getStoredValue(i,e),c=function(t){r.updateState(i,{value:t,key:e.id}),m.text(t),e.onChange&&e.onChange(t),s.hidePopupPanel()};e.sobject?(o=e.sobject,d=i.closest("model")):((a=e.modelname?e.modelname:e.modelprop?i.attr(e.modelprop):i.closest("model").attr("id"))&&(d=r.getModelFromModelName(a)),o=r.getSObjectNameFromModelName(a));var u=n("<div>"),m=n("<div>").addClass("smb-propertyitem-valuetextbox").text(p);i.attr(e.id)!==p&&c(p);var h=n("<div>").addClass("smb-propertyitem-actionbutton fa fa-fw fa-wrench").on("tap",function(){var r=n("<div>").addClass("smb-fielddeckcontrols").css({left:"122px","padding-top":"1px"}),l=new t.FieldSelectDeck(n("<div>"),{breadcrumb:[{rel:o,ref:o,id:a}],controls:r,isSelected:function(t,n){return n+t.id===i.attr(e.id)},onSelect:function(e,t){c(t+e.id)},onUnselect:function(){c("")},getUiOnlyFields:function(){return!(!d||d.attr("sobject")!==o)&&d.children("fields").children('[uionly="true"]')},getFieldXML:function(e,t){var n=t+e.id;return!(!d||d.attr("sobject")!==o)&&d.children("fields").children('[id="'+n+'"]')},filter:e.filter});s.setPopupPanel(l.element,{title:function(e){e.append(n("<span>").text("Select a Field"),r)},noPadding:!0}),l.render()});u.append(h,m),e.element.append(l,u)},panel:function(i,o){var s,a=n("<div>").addClass("sm-field-label").text(i.label),d=i.id,l=[];t.panelsXML.children().each(function(){var e=n(this).attr("uniqueid");l.push({value:e,label:e})}),s=e.ui.renderers.PICKLIST.edit({value:o.attr(d),entries:l,onChange:function(e){r.updateState(o,{key:d,value:e}),i.onChange&&i.onChange(e)}}),i.element.append(a,s)},multiitem:function(e,t){var i=e.id,s=e.storeAs,a=n("<div>").addClass("sm-field-label").text(e.label),d=t.children(i),l=n("<div>");function p(o){var s=n("<div>").addClass("smb-propertyitem-multiitem").css("clear","both"),a=n("<div>").addClass("smb-propertyitem-valuebox"),d=n("<div>").addClass("smb-propertyitem-actionbutton smb-propertyitem-actionbutton-black fa fa-fw fa-times").on("tap",function(t){o.remove(),s.remove(),e.onChange&&e.onChange(),t.gesture.preventDefault()});return a.append(r.getValueEditorFromMetadata(e,t,i,o)),s.append(d,a)}d.length||(d=o("<values/>").append(o("<value/>"))).appendTo(t),d.children(s.name).each(function(){l.append(p(n(this)))}),e.element.append(a,l),e.element.append(n("<div>").text("Add Another Value").addClass("smb-property-action").css("margin-left","0px").on("tap",function(t){var n=o("<value/>").appendTo(d);l.append(p(n)),e.onChange&&e.onChange(),t.gesture.preventDefault()}))},validcomponents:function(e,i){var a=i[0].nodeName.toLowerCase(),l=r.getBuilder(a),p=r.getAvailableComponentsWithFolders(),c=p.noFolderComponents,u=p.activeFolders;if(e.element.css("margin-top","0px"),!c)return!1;var m=function(e,i){if(i&&i.options&&!1===i.options.makeDraggable)return!0;if(!r.doesParentAcceptComponent(i,l))return!0;var o=n("<div>").addClass("smb-component-tag-wrapper"),s=n("<div>").addClass("smb-component-tag").text(i.name),a=n("<div>").addClass("smb-component-titlebuttons"),d=n("<div>").addClass("smb-component-titlebutton smb-component-gripper fa fa-bars fa-fw");a.append(d),s.append(a),s.data("builder",i),t.makeDraggableComponent(s,i),o.append(s),e.append(o)};n.each(c,function(){return m(e.element,this.builder)}),n.each(u,function(){var t=n("<div>").addClass("smb-folder"),i=n("<div>").addClass("smb-folder-header").text(this.name),o=n("<div>").addClass("smb-folder-body");n.each(this.components,function(){return m(o,this.builder)}),o.children().length&&(t.append(i,o),e.element.append(t))}),e.element.on("doubletap",".smb-component-tag",function(a){var l=n(this).data("builder"),p=new t.Component(l.defaultStateGenerator()).render(),c=r.getComponentFromState(i);c.body.append(p.element),p.builder&&p.builder.afterAttach&&p.builder.afterAttach(p);var u=e.childrenNodeName||"components",m=i.children(u).first();m.length||(m=o("<"+u+"/>").appendTo(i)),m.append(p.state),d("skuidBuilderSave"),a.gesture.preventDefault(),a.stopPropagation(),s.processResponsiveArea(c.element)})},remove:function(e,t){var i=t[0].nodeName.toLowerCase(),o=r.getBuilder(i),s=n("<div>").addClass("smb-property-action").text("Remove this "+(o?o.name:"Component")).click(function(){r.getComponentFromState(t).remove(),e.onChange&&e.onChange()});e.element.append(s)},customaction:function(e){var t=n("<div>").addClass("smb-property-action").text(e.label||"Custom Action");e.customAction&&t.on("tap",function(){e.customAction()}),e.element.append(t)},template:function(e,t){e.location||(e.location="node");var o=r.getStoredValue(t,e);if(!o&&e.defaultValue){var s={value:o=e.defaultValue};"node"==e.location&&e.id?s.childNodeName=e.id:"attribute"==e.location&&(s.key=e.id),r.updateState(t,s)}var a=e.displayAs,d=n("<"+("input"===a?"input":"textarea")+">").val(o);i.delayInputCallback(d,function(n){var i={value:n};"node"==e.location&&e.id?i.childNodeName=e.id:"attribute"==e.location&&(i.key=e.id),r.updateState(t,i),e.onChange&&e.onChange(n)});var l=n("<div>").addClass("sm-field-label").text(e.label);e.element.append(l,d)},code:function(e,t){n("<div>").addClass("sm-field-label").text(e.label).appendTo(e.element);var i=n("<div>").css("position","relative").css("height","400px").appendTo(e.element),o=n("<div>").addClass("nx-code-editor").appendTo(i).hide(),s=window.ace.edit(o[0]);e.syntax&&s.getSession().setMode("ace/mode/"+e.syntax),s.setValue(r.getStoredValue(t,e));var a=s.getSession().getUndoManager();a.reset(),s.getSession().setUndoManager(a),s.getSession().getSelection().clearSelection(),o.show(),s.getSession().on("change",function(){var n=s.getValue(),i={value:n};e.id&&(i.childNodeName=e.id),r.updateState(t,i),e.onChange&&e.onChange(n)})}},n.each(["autocomplete","boolean","condition","filepath","icon","model","models","multipicklist","numberbox","quicknumber","picklist","sobject","standard"],function(e,i){t.propertyRenderers[i]=function(e,t){!function(e,t,i){var o=n("<div>").addClass("sm-field-label").text(t.label);t.element.append(o,r.propertyRenderers[e](t,i))}(i,e,t)}}),t.Component=function(e,i){if(!e||!e[0])return!1;if(i?(this.builder=i,this.builderId=this.builder.id):(this.builderId=e[0].nodeName.toLowerCase(),this.builder=r.getBuilder(this.builderId)),!this.builder)return!1;r.registerComponent(this),this.builderoptions=n.extend({allowSelection:!0,makeDraggable:!0,makeSiblingDropZone:!0},this.builder.options),this.element=n("<div>").addClass("smb-component"),this.header=n("<div>").addClass("smb-component-header"),this.headerTitle=n("<div>").addClass("smb-component-header-title").text(this.builder?this.builder.name:this.builderId),this.titleButtons=n("<div>").addClass("smb-component-titlebuttons"),this.gripper=n("<div>").addClass("smb-component-titlebutton smb-component-gripper fa fa-ellipsis-v fa-fw"),this.header.append(this.headerTitle,this.titleButtons),this.builderoptions.makeDraggable&&this.titleButtons.append(this.gripper),this.body=n("<div>").addClass("smb-component-body"),this.element.append(this.header,this.body),this.builderoptions.makeSiblingDropZone&&(this.dropzone=new t.DropZone,this.element.append(this.dropzone.element)),this.state=e,this.element.data("component",this)},t.Component.prototype.setTitle=function(e){return this.headerTitle.text(e),this},t.Component.prototype.setHeaderText=function(e){return this.setTitle(e)},t.Component.prototype.render=function(){return this.builder&&(this.body.empty(),this.builder.mobileRenderer?this.builder.mobileRenderer(this):this.builder.componentRenderer&&this.builder.componentRenderer(this)),this},t.Component.prototype.refresh=function(){return this.body.children().detach(),this.render(),s.processResponsiveElements(),this.builder&&this.builder.afterAttach&&this.builder.afterAttach(this),this},t.Component.prototype.rebuildProps=function(e){return this.renderProperties(e)},t.Component.prototype.renderProperties=function(e){d("skuid.pageComposer.propertyPanel.beforeRender");return e||(e=t.propertyViewer),e&&e.clear(),this.builder&&this.builder.propertiesRenderer(e,this),d("skuid.pageComposer.propertyPanel.afterRender"),this},t.Component.prototype.renderChildren=function(e,t){this.addComponents(e,t||this.body)},t.Component.prototype.addComponents=function(e,i){e||(e="components");var s,a=this.state.children(e).first();a.length||(a=o("<"+e+"/>").appendTo(this.state)),s=a.children(),new t.ComponentAcceptor(i,a),s.each(function(){var e=n(this),o=r.getComponentFromState(e)||new t.Component(n(this));o&&(o.render(),o.element&&(o.element.data("component",o),i.append(o.element),o.builder&&o.builder.afterAttach&&o.builder.afterAttach(o)))})},t.Component.prototype.isSelected=function(){return this===t.componentViewer.selectedComponent},t.Component.prototype.select=function(e){this.builderoptions.allowSelection&&(e=n.extend({showPropertiesPanel:!0},e),t.componentViewer.addSelection(this),this.builderoptions.makeDraggable&&t.makeDraggableComponent(this.element,this.builder),d("skuidBuilderViewProperties",[this]),e.showPropertiesPanel&&s.addLeftPanel("propertyviewer",{transition:"slide",replace:!0,position:1}),d("skuidBuilderComponentSelect",[this]))},t.Component.prototype.unselect=function(){this.element.removeClass("smb-selected"),this.builderoptions.makeDraggable&&this.element.data("ui-draggable")&&this.element.draggable("destroy")},t.Component.prototype.remove=function(){t.componentViewer.clearSelection(),t.propertyViewer.clear(),this.element.remove(),this.state.remove(),this.save(),r.unregisterComponent(this),s.processResponsiveElements()},t.Component.prototype.getPersonalizationService=function(){var t="_personalizationService",n=this[t];return n||(n=this[t]=e.personalization.createComponentService({uniqueId:null})),n},t.Component.prototype.save=function(){return d("skuidBuilderSave"),this},t.ComponentAcceptor=function(e,n){this.element=e.addClass("smb-acceptor"),this.element.data("acceptor",this),this.state=n,this.dropzone=new t.DropZone("acceptor"),this.element.append(this.dropzone.element)},t.DropZone=function(i){var o=this;this.type=i||"component",this.element=n("<div>").addClass("smb-dropzone"),this.element.droppable({accept:function(e){var t=e.data("component"),n=t?t.builder:e.data("builder");if(!n)return!1;var i=o.element.closest(".smb-acceptor").data("acceptor");if(!i)return!1;var s=i.element.closest(".smb-component").data("component").builder;return r.doesParentAcceptComponent(n,s)},tolerance:"touch",drop:function(i,a){if(r.dropStack=n(),o.element.is(".smb-dropzone-hover")){var l,p,c=a.draggable.data("component");if(c)c.state.detach(),c.element.detach();else{var u=a.draggable.data("builder");c=new t.Component(u.defaultStateGenerator()).render()}var m=o.element.closest(".smb-acceptor").data("acceptor").state;"acceptor"===o.type?(l=0,p=o.element):(l=o.element.parent().index(),p=o.element.parent()),p.after(c.element),e.utils.insertAtIndex(m,c.state,l),c.builder&&c.builder.afterAttach&&c.builder.afterAttach(c),d("skuidBuilderSave"),o.element.removeClass("smb-dropzone-hover"),s.processResponsiveElements()}},over:function(){r.dropStack=r.dropStack.add(n(this)),r.dropStack.removeClass("smb-dropzone-hover"),r.dropStack.first().addClass("smb-dropzone-hover")},out:function(){r.dropStack.removeClass("smb-dropzone-hover"),r.dropStack=r.dropStack.not(n(this)),r.dropStack.first().addClass("smb-dropzone-hover")},activeClass:"smb-dropzone-active"})},t.ComponentViewer=function(e){this.element=e.addClass("smb-component-viewer"),this.selectedComponent,e.on("tap",".smb-component",function(e){n(this).data("component").select(),e.gesture.preventDefault(),e.stopPropagation()}),e.on("hold",".smb-component",function(e){n(this).data("component").select({showPropertiesPanel:!1}),e.stopPropagation(),e.preventDefault()})},t.ComponentViewer.prototype.loadComponent=function(e){this.element.children().detach();var n=r.getComponentFromState(e);return n||(n=new t.Component(e).render()),this.element.append(n.element),this.clearSelection(),n},t.ComponentViewer.prototype.addSelection=function(e){this.clearSelection(),this.selectedComponent=e,e.element.addClass("smb-selected")},t.ComponentViewer.prototype.clearSelection=function(){this.selectedComponent&&this.selectedComponent.unselect(),this.selectedComponent=null},t.ComponentViewer.prototype.clear=function(){this.element.empty(),this.clearSelection()},t.PropertyViewer=function(e){this.lists=[],this.element=e.addClass("smb-propview"),this.header=n("<div>").addClass("smb-propview-header sm-title"),this.headerText=n("<div>").addClass("smb-propviewer-headertext"),this.titleButtons=n("<div>").addClass("sm-titlebutton-wrapper"),this.closeButton=n("<div>").addClass("sm-titlebutton fa fa-angle-double-left fa-fw"),this.closeButton.click(function(){s.toggleLeftPanel("propertyviewer",{transition:"slide"})}),this.titleButtons.append(this.closeButton),this.header.append(this.titleButtons,this.headerText),this.body=n("<div>").addClass("smb-propview-body"),this.body.on("click",".smb-propertylist-header",function(){var e=n(this).parent().data("list");e&&e.revealContents&&e.revealContents()}),this.openLists={},this.element.append(this.header,this.body)},t.PropertyViewer.prototype.setTitle=function(e){this.headerText.text(e)},t.PropertyViewer.prototype.setHeaderText=function(e){this.setTitle(e)},t.PropertyViewer.prototype.loadComponent=function(e){this.openLists={},this.clear(),e.renderProperties(this)},t.PropertyViewer.prototype.addList=function(e){e.viewer=this,this.lists.push(e)},t.PropertyViewer.prototype.addLists=function(e){var t=this;n.each(e,function(){this.viewer=t,t.lists.push(this)})},t.PropertyViewer.prototype.render=function(){var e=this;this.body.empty(),n.each(this.lists,function(){this.render(this.state),e.body.append(this.element)})},t.PropertyViewer.prototype.clear=function(){this.body.empty(),this.lists=[],this.setTitle("")},t.PropertyViewer.prototype.applyPropTreeItem=function(e,n){if(e.isChild){var i=e.id;i||(i=e.childrenNodeName);var r=n.children(i);r.length||(r=e.defaultStateFunction&&e.defaultStateFunction()||o("<"+i+"/>"),n.append(r)),this.addList(new t.MiniComponentList(r,e))}else this.addList(new t.MiniComponentList(n,e))},t.PropertyViewer.prototype.applyPropTree=function(e,t){var i=this;e instanceof Array?n.each(e,function(e){i.applyPropTreeItem(this,t,{autoselect:0===e,wrapper:i.body})}):i.applyPropTreeItem(e,t,{autoselect:!0,wrapper:i.body})},t.PropertyViewer.prototype.applyPropsWithCategories=function(e,i){var o=this;n.each(e,function(){var e=this,n=e.state?e.state:i;(e.props&&e.props.length>0||e.customPropFunction||e.tree)&&(e.customPropFunction||(e.tree?o.applyPropTree(e.tree,n):o.addList(new t.PropertyList(n,e))))}),this.render()},t.MiniComponentList=function(e,i){i=i||{};var o=this;this.element=n("<div>").addClass("smb-propertylist"),this.element.data("list",this),this.header=n("<div>").addClass("smb-propertylist-header"),this.body=n("<div>").addClass("smb-propertylist-body").hide(),this.bodycontents=n("<div>"),this.propcontents=n("<div>"),this.expandIndicator=n("<div>").addClass("smb-propertylist-titleicon fa fa-chevron-down fa-fw"),this.items=[],this.inactive=i.inactive,this.state=i.state?i.state:e,this.childNodeCount=0,this.options=i,this.inactive&&this.element.hide(),this.fakeComponent={state:o.state,save:t.Component.prototype.save,rebuildProps:function(){o.getItems(),o.renderItems()},refresh:function(){}},this.childrenNodeName=i.childrenNodeName,this.childNodeName=i.childNodeName,this.childrenNodeName&&this.childNodeName&&(this.childbuilder=r.getBuilder(this.childNodeName),this.body.append(this.createAddButton(this.childbuilder,this.childrenNodeName))),this.body.append(this.propcontents,this.bodycontents),this.headertitle=n("<div>").addClass("smb-propertylist-headertitle").text(i.title||i.label),this.header.append(this.expandIndicator,this.headertitle),(this.childrenNodeName||this.childNodeName||this.options.childrenFunction||this.options.children)&&(this.headercount=n("<div>").addClass("smb-propertylist-headercount"),this.header.append(this.headercount)),this.element.append(this.header,this.body),this.getItems()},t.MiniComponentList.prototype.createAddButton=function(e,t,i){var o=this;return n("<div>").addClass("smb-property-action").text(i||"Add new "+e.name).click(function(){o.addChild(e,t)})},t.MiniComponentList.prototype.addItem=function(e){this.items.push(e)},t.MiniComponentList.prototype.addItems=function(e){var t=this;n.each(e,function(){t.push(this)})},t.MiniComponentList.prototype.getItems=function(){var e=this;e.items=[];var i=this.options,o=i.propsFunction&&i.propsFunction(e.fakeComponent)||i.props||[];o&&n.each(o,function(n,i){e.addItem(new t.PropertyItem(i))})},t.MiniComponentList.prototype.renderItems=function(){var e=this;e.propcontents.empty(),n.each(this.items,function(){this.render(e.state),e.propcontents.append(this.element)})},t.MiniComponentList.prototype.createBuilderFromTreeObj=function(e){var i=e.linkedComponent;return new r.Builder({id:e.id,name:e.id,options:{makeSiblingDropZone:!1,makeDraggable:!1},mobileRenderer:function(t){t.bodycontent.text(e.labelFunction&&e.labelFunction(t.state)||e.label)},propertiesRenderer:function(i,o){var r=e.propsFunction&&e.propsFunction(o)||e.props||[],s=new t.PropertyList(o.state);n.each(r,function(){s.addItem(new t.PropertyItem(this))}),i.addLists([s]);var a=e.childrenFunction&&e.childrenFunction({state:o.state})||e.children;a&&n.each(a,function(){var e=this;i.addList(new t.MiniComponentList(o.state,{title:e.invisibleParentLabel||"Child Components",childrenFunction:function(){return[e]}}))}),i.render()},hideWrapper:!0,defaultStateGenerator:function(){return e.defaultStateFunction&&e.defaultStateFunction()||o("<"+e.id+"/>")},onSelect:function(){i&&i.element.addClass("nx-pagebuilder-selected")},resetPropCategory:!1})},t.MiniComponentList.prototype.render=function(){var e,i,o=this;if(o.bodycontents.empty(),o.childbuilder&&o.childrenNodeName){if(this.inactive)return!1;var r=this.state.children(this.childrenNodeName).first().children();r.each(function(){var e=new t.MiniComponent(n(this),o.childbuilder);e.render(),o.bodycontents.append(e.element)}),this.setCount(r.length)}else o.renderItems(),e=o.options.childrenFunction&&o.options.childrenFunction({state:o.state})||o.options.children,i=0,e&&e.length&&n.each(e,function(){var e,r=this,s=o.createBuilderFromTreeObj(r);o.bodycontents.append(o.createAddButton(s,r.invisibleParent,r.addtooltip)),e=n("<div>"),o.bodycontents.append(e),e.sortableComponent({axis:"y",component:o.fakeComponent,parentStateSelector:r.invisibleParent,placeholder:"sk-placeholder",onSort:function(){o.render()},handle:".smb-minicomponent-handle"}),r.invisibleParent?o.state.children(r.invisibleParent).each(function(){n(this).children(r.id).each(function(){var o=new t.MiniComponent(n(this),s);o.render(),e.append(o.element),i++})}):o.state.children(r.id).each(function(){var o=new t.MiniComponent(n(this),s);o.render(),e.append(o.element),i++})}),this.setCount(i)},t.MiniComponentList.prototype.addChild=function(e,n){var i=new t.MiniComponent(e.defaultStateGenerator(),e);if(n){var r=this.state.children(n).first();r.length||(r=o("<"+n+"/>").appendTo(this.state)),this.state.children(n).first().append(i.state)}else this.state.append(i.state);this.bodycontents.append(i.element),i.render(),this.increaseCount(),d("skuidBuilderSave")},t.MiniComponentList.prototype.revealContents=function(){this.body.slideToggle()},t.MiniComponentList.prototype.decreaseCount=function(){this.setCount(this.childNodeCount-1)},t.MiniComponentList.prototype.increaseCount=function(){this.setCount(this.childNodeCount+1)},t.MiniComponentList.prototype.setCount=function(e){this.childNodeCount=e,this.headercount&&this.headercount.text(this.childNodeCount)},t.MiniComponent=function(e,i){var o=this;this.builderId=i.id,this.builder=i,this.state=e,this.element=n("<div>").addClass("smb-minicomponent"),this.handle=n("<div>").addClass("smb-minicomponent-handle fa fa-ellipsis-v"),this.body=n("<div>").addClass("smb-minicomponent-body"),this.bodycontent=n("<div>").addClass("smb-minicomponent-content"),this.properties=new t.MiniPropViewer;var s=n("<div>").addClass("smb-minicomponent-removeicon fa fa-times fa-fw").click(function(e){o.remove(),e.stopPropagation()});r.registerComponent(o),this.body.append(s,this.bodycontent),this.element.append(this.handle,this.body,this.properties.element),this.body.on("click",function(){o.properties.element.slideToggle()})},t.MiniComponent.prototype.refresh=function(){return this.bodycontent.empty(),this.builder.mobileRenderer(this),this},t.MiniComponent.prototype.render=function(){this.builder&&(this.builder.mobileRenderer(this),this.builder.propertiesRenderer(this.properties,this))},t.MiniComponent.prototype.renderProperties=function(){return this.properties.clear(),this.builder.propertiesRenderer(this.properties,this),this},t.MiniComponent.prototype.rebuildProps=function(){return this.renderProperties()},t.MiniComponent.prototype.remove=function(){this.element.closest(".smb-propertylist").data("list").decreaseCount(),this.element.remove(),this.state.remove(),r.unregisterComponent(this),d("skuidBuilderSave")},t.MiniComponent.prototype.save=function(){return d("skuidBuilderSave"),this},t.MiniPropViewer=function(){this.lists=[],this.element=n("<div>").addClass("smb-minicomponent-propviewer").hide()},t.MiniPropViewer.prototype.clear=function(){this.lists=[],this.element.empty()},t.MiniPropViewer.prototype.addList=function(e){this.lists.push(e)},t.MiniPropViewer.prototype.addLists=function(e){var t=this;n.each(e,function(){t.lists.push(this)})},t.MiniPropViewer.prototype.render=function(){var e=this;this.element.empty(),n.each(this.lists,function(){this.render(this.state),e.element.append(this.element)})},t.MiniPropViewer.prototype.applyPropTreeItem=t.PropertyViewer.prototype.applyPropTreeItem,t.MiniPropViewer.prototype.applyPropTree=t.PropertyViewer.prototype.applyPropTree,t.MiniPropViewer.prototype.applyPropsWithCategories=t.PropertyViewer.prototype.applyPropsWithCategories,t.PropertyList=function(e,i){var o=this;i=n.extend({expanded:!1,title:""},i),o.items=[],o.element=n("<div>").addClass("smb-propertylist"),o.element.data("list",o),o.header=n("<div>").addClass("smb-propertylist-header"),o.body=n("<div>").addClass("smb-propertylist-body"),o.expanded=i.expanded,o.viewer=null,o.name=i.title||i.name||i.label,o.element.append(o.header,o.body),o.state=e;var r=i.propsFunction&&i.propsFunction({state:o.state,save:t.Component.prototype.save})||i.props||[];r&&n.each(r,function(e,n){o.addItem(new t.PropertyItem(n))})},t.PropertyList.prototype.addItem=function(e){this.items.push(e)},t.PropertyList.prototype.addItems=function(e){var t=this;n.each(e,function(){t.push(this)})},t.PropertyList.prototype.render=function(){var e=this,t=!1;this.body.empty(),this.name?(t=this.viewer&&this.viewer.openLists&&this.name in this.viewer.openLists?!!this.viewer.openLists[this.name]:this.expanded,this.headertitle=n("<div>").addClass("smb-propertylist-headertitle").text(this.name),this.expandIndicator=n("<div>").addClass("smb-propertylist-titleicon fa fa-chevron-"+(t?"up":"down")+" fa-fw"),this.header.append(this.expandIndicator,this.headertitle)):t=!0,this.expanded=t,this.expanded?this.body.css("display",""):this.body.css("display","none"),n.each(this.items,function(){this.render(e.state),e.body.append(this.element)})},t.PropertyList.prototype.revealContents=function(){this.expanded=!this.expanded,this.expandIndicator.removeClass("fa-chevron-"+(this.expanded?"down":"up")),this.expandIndicator.addClass("fa-chevron-"+(this.expanded?"up":"down")),this.body.slideToggle(),this.viewer&&(this.viewer.openLists[this.name]=this.expanded)},t.PropertyItem=function(e){this.element=n("<div>").addClass("smb-propertyitem"),n.extend(this,e)},t.PropertyItem.prototype.render=function(e){this.element.empty();var n=this.type||"standard";t.propertyRenderers[n]?t.propertyRenderers[n](this,e):t.propertyRenderers.standard(this,e)},t.setupPageXML=function(e){if(e||(e=t.model.getFieldValues(t.row,r.getLayoutFields(),!0).join("")),e.length){t.pageXML=o(e);var n=t.pageXML.children("components").first();t.mobileXML=n.children("skuidmobile").first(),t.mobileXML.length||(t.mobileXML=o("<skuidmobile><mobilepanels/><mobilenavs/></skuidmobile>").appendTo(n)),t.modelsXML=t.pageXML.children("models").first(),t.resourcesXML=t.pageXML.children("resources").first(),t.panelsXML=t.mobileXML.children("mobilepanels").first(),t.navsXML=t.mobileXML.children("mobilenavs").first()}r.pageXML=t.pageXML,d("skuidBuilderXMLLoaded")},l("mobileComponentViewer",function(i){t.model=r.pageModel=e.$M("page"),t.row=r.pageRow=t.model.getFirstRow(),t.setupPageXML();var o=new t.ComponentViewer(i),l=function(){s.setLeftPanel("quicknav",{displaymode:"fit",preventProcessing:!0,transition:"none"}).then(function(){s.addLeftPanel("panels",{displaymode:"push",position:1}),n(".sm-buttonset-nav").removeClass("sm-active"),n("#quicknav").children().eq(2).addClass("sm-active")})};a("skuidBuilderSave",function(){r.save(t.pageXML[0],t.model,t.row)}),t.componentViewer=o,a("skuidMobileReady",function(){l()}),a("skuidMobileSavePage",function(t){t&&t.button&&t.button.startProcessing(),e.$M("page").save({callback:function(){t&&t.button&&t.button.stopProcessing()}})}),a("skuidMobileCancelPage",function(){e.$M("page").cancel(),e.builder.mobile.setupPageXML(),t.propertyViewer.clear(),t.componentViewer.clear(),d("skuidBuilderRefreshModelList"),d("skuidBuilderRefreshNavList"),d("skuidBuilderRefreshPanelList"),d("skuidBuilderRefreshLabelList"),d("skuidBuilderRefreshJSItemList"),d("skuidBuilderRefreshCSSItemList"),l()}),a("skuidMobilePreviewPage",function(){var t=e.$M("page"),n=e.snippet.get("skuid.builder.page.preview");n&&n({model:t})})}),l("mobilePropertyViewer",function(e){var n=new t.PropertyViewer(e);a("skuidBuilderViewProperties",function(e){n.loadComponent(e)}),t.propertyViewer=n}),l("mobileBuilderPageProperty_Theme",function(i){var o=n.map(e.builder.core.availableThemes,function(e){return{label:e.Name,value:e.Name}});o.unshift({label:"Default",value:""});var r={id:"theme",type:"picklist",label:"Theme",picklistEntries:o,helptext:"The name of the theme to use."},s=new t.PropertyItem(r);s.render(t.pageXML),i.append(s.element)}),l("mobileBuilderPageProperty_UnsavedChangesWarning",function(e){var n=new t.PropertyItem({id:"unsavedchangeswarning",type:"picklist",label:"Warn users if page has unsaved changes",picklistEntries:[{label:"No",value:""},{label:"Yes",value:"yes"}],defaultValue:"",helptext:"If a user tries to leave or close this page, and one or more of its Models has unsaved changes, a warning message will be shown before they can leave."});n.render(t.pageXML),e.append(n.element)}),l("mobileBuilderModelList",function(e){e.append(p("mobileBuilderPropertyPanelHeader")({title:"Models",showCloseButton:!0,closePanel:"models",showAddButton:!0,eventToPublishOnAdd:"skuidBuilderAddModel"}),p("mobileBuilderPropertyPanelList")({xmlParentFunction:function(){return t.modelsXML},addEventName:"skuidBuilderAddModel",builderName:"model",refreshEventName:"skuidBuilderRefreshModelList",labelFunction:function(e){return e.attr("id")},showRemoveButton:!1}))}),l("mobileBuilderNavList",function(e){e.append(p("mobileBuilderPropertyPanelHeader")({title:"Headers and Footers",showCloseButton:!0,closePanel:"navs",showAddButton:!0,eventToPublishOnAdd:"skuidBuilderAddNav"}),p("mobileBuilderPropertyPanelList")({xmlParentFunction:function(){return t.navsXML},addEventName:"skuidBuilderAddNav",builderName:"mobilenav",refreshEventName:"skuidBuilderRefreshNavList",labelFunction:function(e){var t="footer"===e.attr("type")?"Footer":"Header",n=e.attr("name")||t;return e.attr("uniqueid")?n+=" - "+e.attr("uniqueid"):n+=" - [New "+t+"]",n},showRemoveButton:!1}))}),l("mobileBuilderPanelList",function(e){e.append(p("mobileBuilderPropertyPanelHeader")({title:"Page Panels",showCloseButton:!0,closePanel:"panels",showAddButton:!0,eventToPublishOnAdd:"skuidBuilderAddPanel"}),p("mobileBuilderPropertyPanelList")({xmlParentFunction:function(){return t.panelsXML},addEventName:"skuidBuilderAddPanel",builderName:"mobilepanel",refreshEventName:"skuidBuilderRefreshPanelList",labelFunction:function(e){return e.attr("uniqueid")||"[New Panel]"},showRemoveButton:!1}))}),l("mobileBuilderPropertyPanelList",function(e){var i=e.element||n("<div>");i.on("tap",".sm-button-custom",function(){var i=e.xmlParentFunction&&e.xmlParentFunction(),o=n(this).index();t.componentViewer.loadComponent(i.children().eq(o)),s.processResponsiveElements()});var o=function o(){var r=e.xmlParentFunction&&e.xmlParentFunction(),a={state:r,save:t.Component.prototype.save,rebuildProps:function(){o()}};i.empty(),i.sortableComponent({axis:"y",component:a,placeholder:"sk-placeholder",onSort:function(){o()},handle:".smb-minicomponent-handle"}),r.children().each(function(){var o,r,a=n(this),d=new s.ui.Button({icon:e.icon,iconColor:"#bbb",label:e.labelFunction(a)});d.element.css("position","relative").addClass("smb-menupropertylist sm-button-custom sm-liststyle sm-level"+(e.indentLevel||0)),e.showRemoveButton&&(o=n("<div>").addClass("sm-titlebutton sm-accordion-item-button fa fa-times fa-fw").on("tap",function(e){new t.Component(a).remove(),t.componentViewer.clear(),d.element.remove(),e.stopPropagation()}),r=n("<div>").addClass("sm-titlebutton-wrapper").append(o),d.element.append(r)),d.element.append(n("<div>").addClass("smb-minicomponent-handle fa fa-ellipsis-v")),i.append(d.element)})};return o(),a(e.addEventName,function(n){var i,a=e.xmlParentFunction&&e.xmlParentFunction();n=n&&n.jquery?n.clone():r.getBuilder(e.builderName).defaultStateGenerator(),a.length||(i=e.xmlGrandParentFunction&&e.xmlGrandParentFunction(),a=r.defaultStateGenerators[e.parentBuilderName](),i.append(a)),a.append(n),t.componentViewer.loadComponent(n).select(),s.processResponsiveElements(),d("skuidBuilderSave"),o()}),a(e.refreshEventName,function(){o()}),i}),l("mobileBuilderPropertyPanelHeader",function(e){var t,i,o=e.element||n("<div>"),r=n("<div>").addClass("sm-titlebutton-wrapper").appendTo(o);return o.addClass("smb-propview-header sm-title").css("padding","10px 10px 9px 10px"),n("<div>").addClass("smb-propviewer-headertext").text(e.title).appendTo(o),e.showCloseButton&&(t=n("<div>").addClass("sm-titlebutton fa fa-angle-double-left fa-fw").appendTo(r),e.closePanel&&t.click(function(){s.toggleLeftPanel(e.closePanel,{transition:"slide"})})),e.showAddButton&&(i=n("<div>").addClass("sm-titlebutton fa fa-plus-circle fa-fw").appendTo(r),e.eventToPublishOnAdd&&i.click(function(){d(e.eventToPublishOnAdd)})),o}),l("mobileBuilderPagePropertiesHeader",function(e){p("mobileBuilderPropertyPanelHeader")({element:e,title:"Edit Page Properties",showCloseButton:!0,closePanel:"pageproperties"})}),l("mobileBuilderResourcePanelHeader",function(e){p("mobileBuilderPropertyPanelHeader")({element:e,title:"Resources",showCloseButton:!0,closePanel:"resources"})}),l("mobileBuilderLabelList",function(e){p("mobileBuilderPropertyPanelList")({element:e,icon:"fa-angle-double-right",xmlParentFunction:function(){return t.resourcesXML.children("labels")},xmlGrandParentFunction:function(){return t.resourcesXML},addEventName:"skuidMobileAddLabelItem",builderName:"label",parentBuilderName:"labels",refreshEventName:"skuidBuilderRefreshLabelList",labelFunction:function(e){return e.attr("id")||"[No Label ID]"},showRemoveButton:!0,indentLevel:2})}),l("mobileBuilderJSList",function(e){p("mobileBuilderPropertyPanelList")({element:e,icon:"fa-angle-double-right",xmlParentFunction:function(){return t.resourcesXML.children("javascript")},xmlGrandParentFunction:function(){return t.resourcesXML},addEventName:"skuidMobileAddJSItem",builderName:"jsitem",parentBuilderName:"javascript",refreshEventName:"skuidBuilderRefreshJSItemList",labelFunction:function(e){return r.getJSItemLabel(e).name||"[No Javascript Item Name]"},showRemoveButton:!0,indentLevel:2})}),l("mobileBuilderCSSList",function(e){p("mobileBuilderPropertyPanelList")({element:e,icon:"fa-angle-double-right",xmlParentFunction:function(){return t.resourcesXML.children("css")},xmlGrandParentFunction:function(){return t.resourcesXML},addEventName:"skuidMobileAddCSSItem",builderName:"cssitem",parentBuilderName:"css",refreshEventName:"skuidBuilderRefreshCSSItemList",labelFunction:function(e){var t=r.getCSSItemLabel(e);return t.prefix+" "+t.name},showRemoveButton:!0,indentLevel:2})}),l("mobileBuilderXMLEditLink",function(t){var n=new e.ui.Editor(t),i=new s.ui.Button({icon:"fa-code",label:"Edit Page XML"});i.element.addClass("sm-button").click(function(){window.location="/apex/skuid__ui?page=PageXMLEdit&id="+e.$M("page").data[0].Id}),n.registerModel(e.$M("page")),n.handleSave=function(e){e&&t.show()},n.handleCancel=function(){t.show()},n.handleChange=function(){t.hide()},t.append(i.element)}),a("skuidBuilderComponentSelect",function(e){"model"===e.builderId&&r.setLastSelectedModelComponent(e)}),e.snippet.register("saveAndPreview",function(){var t=arguments[0],n=t.model||e.$M("page"),i=t.component.editor,o=e.snippet.get("skuid.builder.page.preview");o&&o({editor:i,model:n,saveFirst:!0})})}(skuid)}});