!function(e){var t={};function a(r){if(t[r])return t[r].exports;var n=t[r]={i:r,l:!1,exports:{}};return e[r].call(n.exports,n,n.exports,a),n.l=!0,n.exports}a.m=e,a.c=t,a.d=function(e,t,r){a.o(e,t)||Object.defineProperty(e,t,{configurable:!1,enumerable:!0,get:r})},a.r=function(e){Object.defineProperty(e,"__esModule",{value:!0})},a.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return a.d(t,"a",t),t},a.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},a.p="",a(a.s=345)}({345:function(e,t,a){"use strict";var r,n=a(40),s=(r=n)&&r.__esModule?r:{default:r};!function(e){var t=e.snippet.register,a=e.$,r=e.utils,n=e.constants,o=n.MIME_TYPES.JSON,i=n.SALESFORCE;function u(e){var t="",a=e.responseJSON;return a?(a.error&&(t+=a.error),a.message&&(t+=(t?": ":"")+a.message)):t+=e.responseText,r.reject({$PreviousAction:{error:t}})}function c(){return s.default.getAPIToken().then(function(e){return{Accept:o,"Content-Type":o,Authorization:"Bearer "+e.jwt}})}function d(){return e.$M("stng__DataSources")}function l(){return d().getFirstRow()}function f(t,a){var r=e.$M("stng__DataServices"),n=e.platform.getEntityFieldNames("data_source"),s=n.data_service_id,o=n.data_service,i=t.getFieldValue(a,s,!0),u=t.getFieldValue(a,o,!0);return!u&&i&&(u=a[o]=r.getRowById(i)),u}function p(t){return"https://"+t[e.platform.getEntityFieldName("data_service","host")]+":"+t[e.platform.getEntityFieldName("data_service","port")]}function m(){return p(f(d(),l()))}function g(){return m()+"/api/v2/datasources/"+l()[e.platform.getEntityFieldName("data_source","external_id")]+"/source-entity"}function h(e){return c().then(function(t){return a.ajax({url:g(),method:"PATCH",headers:t,data:JSON.stringify({operation:"import",payload:[{entity:e.name,schema:e.schema}]}),contentType:o,dataType:"json"}).catch(u)})}function S(){var t=e.$M("stng__DataServiceSettings");return t.emptyData(),e.remote.promisify(e.remote(),"getDataServiceConfig").then(function(e){t.adoptRow(e)})}t("DSC_Value_Editor",function(t,a){"userinfo"===t.row.type?"read"===t.mode||"readonly"===t.mode?(t.required=!0,e.ui.fieldRenderers[t.metadata.displaytype].read(t,a)):(t.required=!0,t.metadata.picklistEntries=[{label:"First Name",value:"first_name"},{label:"Email",value:"email"},{label:"Last Name",value:"last_name"},{label:"Username",value:"username"},{label:"Federation Id",value:"federation_id"}],e.ui.fieldRenderers.PICKLIST.edit(t,a)):(t.required=!1,e.ui.fieldRenderers[t.metadata.displaytype][t.mode](t,a))}),t("Update_DSC_Value_Editor",function(e){var t=e.component,r=e.rowId,n=e.row,s=t.registeredFieldsByRowThenField[r].value;t.updateRow(n,"value",""),a.each(s,function(){this.render()})}),t("BuildProfilePermissionSummary",function(){var t=arguments[0].model,r=["createable","deleteable","queryable","updateable"],n=e.$M("Profile"),s={};a.each(t.data,function(e,t){var n=t.permission_set_id;s[n]={},a.each(r,function(e,a){s[n][a]=t[a]})});var o={};a.each(n.getRows(),function(t,n){var i=s[n[e.platform.getEntityFieldName("profile","name")]],u=o[n[e.platform.getEntityFieldName("profile","id")]]={};a.each(r,function(e,t){i&&(u[t]=i[t])})}),n.updateRows(o),n.hasChanged=!1,n.originals=a.extend({},n.changes),n.changes={},n.cancel()}),t("buildPermissionCache",function(){var t=arguments[0].model,r={},n=void 0,s=void 0,o=void 0;switch(t.id){case"DataSourceObjectPermissions":n="data_source_object_id",s="stng__DataSourceObjects",o={queryable:"queryable",createable:"createable",updateable:"updateable",deleteable:"deleteable"};break;case"DataSourceFieldPermissions":n="data_source_field_id",s="stng__DataSourceFields",o={queryable:"queryable",createable:"createable",updateable:"updateable"};break;case"DataSourceConditionPermissions":n="data_source_condition_id",s="stng__DataSourceConditions",o={alwaysOn:"always_on"}}if(n){var i=e.$M(s);a.each(t.data,function(e,t){var s=t[n];r[s]={},a.each(o,function(e,a){r[s][a]=t[e]})});var u={};a.each(i.getRows(),function(e,t){var n=r[t.id],s=u[t.id]={};a.each(o,function(e,t){n&&(s[t]=n[t])})}),i.updateRows(u),i.hasChanged=!1,i.originals=a.extend({},i.changes),i.changes={},i.cancel()}}),t("saveScheme",function(){var t=e.$M("stng__DataSource_Warden").getFirstRow(),r=e.$M("stng__DataSourceObjects").getFirstRow(),n=e.$M("stng__DataSourceFields"),s=e.$M("stng__DataSourceConditions"),i={name:e.$M("Profile").getFirstRow()[e.platform.getEntityFieldName("profile","name")],dataSourcePermissions:{}},u={dataSourceObjectPermissions:{}},d={createable:!!r.createable,queryable:!!r.queryable,updateable:!!r.updateable,deleteable:!!r.deleteable,dataSourceFieldPermissions:{},dataSourceConditionPermissions:{}};return a.each(n.data,function(e,t){d.dataSourceFieldPermissions[t.name]={createable:!!t.createable,queryable:!!t.queryable,updateable:!!t.updateable}}),a.each(s.data,function(e,t){d.dataSourceConditionPermissions[t.name]={alwaysOn:!!t.always_on}}),u.dataSourceObjectPermissions[r.name]=d,i.dataSourcePermissions[t.name]=u,c().then(function(e){return a.ajax({url:m()+"/api/v2/permissionsets",method:"PATCH",headers:e,data:JSON.stringify(i),contentType:o,dataType:"json"})})}),t("skuid.settings.dataSources.pingDataService",function(e){return c().then(function(t){return a.ajax({url:p(e.row)+"/api/v2/ping",method:"GET",headers:t}).catch(u)})}),t("skuid.settings.dataSources.registerDataService",function(t){return c().then(function(s){var o=e.utils.userInfo.organizationId,i=a.extend(s,{"x-skuid-public-key-endpoint":e.platform.getPublicKeyEndpoint()});return r.inPlatform([n.VISUALFORCE,n.LIGHTNING])&&(i["x-skuid-session-id"]=e.utils.userInfo.sessionId),a.ajax({url:p(t.row)+"/api/v2/site/"+o+"/register",method:"POST",headers:i}).catch(u)})}),t("importDSO",function(e){return h(e.row)}),t("importMultipleDSOs",function(e){return a.when.all(e.rows.map(h))}),t("importDSOS",function(){var t=e.$;return c().then(function(a){return t.ajax({url:g(),headers:a}).then(function(a){var r=e.$M("stng__DSOImport");r.abandonAllRows(),r.adoptRows(t.map(a,function(e){return{name:e.tablename,schema:e.tableschema}}))}).catch(u)})}),t("outboundIPsComponent",function(t){var r=e.$M("stng__SiteEnv"),n=r.getFirstRow(),s=n&&r.getFieldValue(n,"PLINY_OUTBOUND_IP_ADDRESSES");if(s&&s.length){var o=a("<h3>").text("Skuid Outbound Connection IP Addresses"),i=a("<p>").text("Skuid may use any one of the following static IP addresses to connect directly from the cloud to your datasources."),u=a("<p>").text("If you use a firewall for your datasources, these IP addresses may need to be whitelisted on your firewall."),c=a("<ul>");a.each(s,function(e,t){c.append(a("<li>").text(t))}),t.append(o,i,u,c)}}),t("v1.importDSOS",function(){var t,r=e.$M("stng__DataSources").getFirstRow(),n=r.name,s=r.type,o={};return o[n]={},a.ajax({method:"POST",url:"/metadata/metaservice",data:JSON.stringify({dataSources:o}),contentType:"application/json",dataType:"json"}).then(function(r){var o=r.dataSourceTypes[s].dataSources[n];return t=o.dataServiceUrl,a.ajax({url:t+"/getSourceEntityList",headers:{"x-skuid-session-id":e.utils.userInfo.sessionId,"x-skuid-data-source":n,"x-skuid-options-schemas":!0}})}).then(function(r){var s=e.$M("stng__DSOImport");s.abandonAllRows(),s.adoptRows(a.map(r,function(e){return{name:e.tablename,schema:e.tableschema,url:t,dsName:n}}))}).catch(function(e){var t=e.responseJSON;return a.Deferred().reject({$PreviousAction:{error:t.error+": "+t.message}}).promise()})}),t("v1.importDSO",function(t){var r=t.row;return a.ajax({url:r.url+"/getSourceEntityMetadata",method:"POST",headers:{"x-skuid-session-id":e.utils.userInfo.sessionId,"x-skuid-data-source":r.dsName,"x-skuid-options-schemas":!0},data:JSON.stringify({entity:r.name,schema:r.schema}),contentType:"application/json",dataType:"json"}).then(function(e){return e.dataSource=r.dsName,a.ajax({url:"/api/v1/dso/import",method:"POST",data:JSON.stringify(e),contentType:"application/json",dataType:"json"})}).catch(function(e){var t="",r=e.responseJSON;return r?(r.error&&(t+=r.error),r.message&&(t+=": "+r.message)):t+=e.responseText,a.Deferred().reject({$PreviousAction:{error:t}}).promise()})}),t("v1.importMultipleDSOs",function(t){var r=t.rows;function n(e){var t="",r=e.responseJSON;return r?(r.error&&(t+=r.error),r.message&&(t+=": "+r.message)):t+=e.responseText,a.Deferred().reject({$PreviousAction:{error:t}}).promise()}return a.when.apply(a,r.map(function(t){return a.ajax({url:t.url+"/getSourceEntityMetadata",method:"POST",headers:{"x-skuid-session-id":e.utils.userInfo.sessionId,"x-skuid-data-source":t.dsName,"x-skuid-options-schemas":!0},data:JSON.stringify({entity:t.name,schema:t.schema}),contentType:"application/json",dataType:"json"}).then(function(e){return e.dataSource=t.dsName,a.ajax({url:"/api/v1/dso/import",method:"POST",data:JSON.stringify(e),contentType:"application/json",dataType:"json"})}).catch(n)}))}),t("v1.testConn",function(){var t,r=e.$M("stng__DataSources").getFirstRow(),n=r.name,s=r.type,o={};o[n]={};var i=e.$M("stng__ConnectionTest"),u=i.createRow(),c=a.Deferred();return a.ajax({method:"POST",url:"/metadata/metaservice",data:JSON.stringify({dataSources:o}),contentType:"application/json",dataType:"json"}).then(function(r){var o=r.dataSourceTypes[s].dataSources[n];return t=o.dataServiceUrl,a.ajax({url:t+"/poke",headers:{"x-skuid-session-id":e.utils.userInfo.sessionId,"x-skuid-data-source":n,"x-skuid-options-schemas":!0},timeout:5e3})}).then(function(){return u.status="Success!",u.message="The Data Source appears to be correctly configured.",i.save(),c.resolve(!0)},function(e){return u.status="Unsuccessful.",u.message="Skuid could not connect to the Data Source.\n",u.message+="Please check all configuration values and make sure the Data Source ",u.message+="can be accessed from Skuid's web servers in your region.\n\n",e&&e.statusText&&"timeout"!==e.statusText&&(u.message+=e.statusText),i.save(),c.resolve(!0)}),c.promise()}),t("v1.testNewConn",function(){var t=e.$M("stng__DataSources").getFirstRow(),r=e.$M("stng__SiteEnv").getFirstRow(),n=e.$M("stng__ConnectionTest"),s=n.createRow(),o={name:t.name,url:t.url,database_username:t.database_username,database_password:t.database_password,database_name:t.database_name,type:{MicrosoftSQL:"mssql",MySQL:"mysql",OracleDB:"oracledb",PostgreSQL:"pg",AmazonRedshift:"redshift",SQLite3:"sqlite3"}[t.type],ssl:t.config&&t.config.ssl},i=r.PLINY_WARDEN_HOST_NAME+"/api/v1",u=a.Deferred();return a.ajax({method:"POST",url:i+"/pokeNew",headers:{"x-skuid-session-id":e.utils.userInfo.sessionId,"x-skuid-options-schemas":!0},data:JSON.stringify(o),contentType:"application/json",dataType:"json",timeout:5e3}).then(function(){return s.status="Success!",s.message="The Data Source appears to be correctly configured.",n.save(),u.resolve(!0)},function(e){return s.status="Unsuccessful.",s.message="Skuid could not connect to the Data Source.\n",s.message+="Please check all configuration values and make sure the Data Source ",s.message+="can be accessed from Skuid's web servers in your region.\n\n",e&&e.statusText&&"timeout"!==e.statusText&&(s.message+=e.statusText),n.save(),u.resolve(!0)}),u.promise()}),t("skuid.settings.dataSources.getCertificates",function(){return r.inPlatform(n.VISUALFORCE)?e.sfdc.api.query("SELECT DeveloperName,MasterLabel FROM Certificate ORDER BY MasterLabel",{useToolingApi:!0}).then(function(e){return e.records.map(function(e){var t=e.DeveloperName;return{label:e.MasterLabel,value:t}})}):r.resolve([])}),t("skuid.settings.dataSources.queryDataServiceConfig",S),t("skuid.settings.dataSources.modifyDataServiceConfig",function(){var t=e.$M("stng__ModifyDataServiceSettings"),a=t.getFirstRow(),n=t.getRowChanges(a),s=e.dataSource.get(i),o=e.dataSource.getType(i),u=void 0;function c(){return o.makeMetadataApiRequest({dataSource:s,body:"<checkDeployStatus><id>"+u+"</id></checkDeployStatus>"})}return e.remote.promisify(e.remote(),"modifyDataServiceConfig",JSON.stringify(n)).then(function(e){return u=e,function e(){return r.delay(500).then(c).then(function(t){if("true"===t.done){if("true"===t.success)return"Job Succeeded";throw"Job failed: "+t.details}return e()})}()}).then(S).catch(function(e){return r.reject({$PreviousAction:{error:e}})})}),e.events.subscribe("skuid.settings.jwtSigningCertificateChanged",s.default.refreshAPIToken)}(skuid)},40:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var a=0;a<t.length;a++){var r=t[a];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,a,r){return a&&e(t.prototype,a),r&&e(t,r),t}}();var n=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}return r(e,[{key:"refreshAPIToken",value:function(){var e=this;return skuid.platform.services.getToken().then(function(t){var a=t.token,r=e.extractJWTPayload(a).exp;return e.apiToken={expiration:r,jwt:a}})}},{key:"extractJWTPayload",value:function(e){var t=e.split(".");if(3!=t.length)throw new Error("JWT not formatted correctly");return JSON.parse(atob(t[1]))}},{key:"getAPIToken",value:function(){var e=this.apiToken;return e&&this.isValid(e)?skuid.utils.resolve(e):this.refreshAPIToken()}},{key:"isValid",value:function(e){var t=void 0;return(t=skuid.utils.isString(e)?this.extractJWTPayload(e).exp:e.expiration)&&t>Date.now()/1e3}}]),e}();t.default=new n}});